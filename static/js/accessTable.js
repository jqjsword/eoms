import GSTC from"../gstc/gstc.esm.min.js";import{licensePublic}from"../gstc/keys.js";const GSTCID=GSTC.api.GSTCID;var iitems=[];const columnsFromDB=[{id:"id",label:"ID",data:({row:t})=>Number(GSTC.api.sourceID(t.id)),sortable:({row:t})=>Number(GSTC.api.sourceID(t.id)),width:80,header:{content:"ID"}},{id:"label",data:"label",sortable:"label",expander:!0,isHTML:!1,width:200,header:{content:"地面站"}}],hours=[{zoomTo:100,period:"hour",periodIncrement:1,format({timeStart:t}){return t.format("HH:mm DD MMMM YYYY")}}],minutes=[{zoomTo:100,period:"minute",periodIncrement:15,main:!0,format({timeStart:t,vido:e}){return e.html`<div style="text-align:center;">${t.format("HH:mm")}</div>`}}];function formatDateTime(t){var e=t.getFullYear(),a=(a=t.getMonth()+1)<10?"0"+a:a,r=(r=t.getDate())<10?"0"+r:r,i=(i=t.getHours())<10?"0"+i:i,o=(o=t.getMinutes())<10?"0"+o:o,t=t.getSeconds();return e+"-"+a+"-"+r+" "+i+":"+o+":"+(t=t<10?"0"+t:t)}function formatDate(t){var e=t.getFullYear(),a=(a=t.getMonth()+1)<10?"0"+a:a,t=t.getDate();return e+"-"+a+"-"+(t=t<10?"0"+t:t)}var sstate,rrows={};function itemSlot(t,e){const{onChange:a,update:r,html:i,api:o,getElement:n}=t;let s,m;function l(t){s=t,m=m||tippy(s)}let d,c,u,p;return a(t=>{(e=t)&&(d=o.getItemData(e.item.id),c=d.time.startDate,u=d.time.endDate,p=`${e.item.label} 从 ${c.format("YYYY-MM-DD HH:mm:ss")} 至 ${u.format("YYYY-MM-DD HH:mm:ss")}`,r(()=>{m.setContent(p)}))}),t=>i`<div
      directive=${n(l)}
      class="my-item"
      style="width:100%;display:flex;"
    >
      ${t}
    </div>`}function rowSlot(t,e){const{html:a,onChange:r,update:i,api:o}=t;let n="";return r(t=>{(e=t)&&(n=e.row.img,i())}),t=>"label"===o.sourceID(e.column.id)?a`<div class="row-content-wrapper" style="display:flex">
          <div class="row-content" style="flex-grow:1;">${t}</div>
          <div
            class="row-image"
            style="background:url(${n}),transparent;border-radius:100%;width:34px;height:34px;vertical-align: middle;background-size: 100%;margin: 11px 11px 0px 0px;"
          ></div>
        </div>`:t}$(document).ready(function(){var t=sessionStorage.getItem("par"),t=JSON.parse(t);(new Date).setTime(t.StartTime),(new Date).setTime(t.EndTime),$.post("http://8.140.167.224:8000/GetAccessTable",{SatNames:t.SatNames,StationNames:t.StationNames,"Start Time":t.StartTime,"End Time":t.EndTime},function(t,e){var a,r=JSON.parse(t),i=r.data,t=r.start,r=r.end;rrows={},iitems=[];let o=0,n=0;for(a in i){var s=GSTCID(String(o));rrows[s]={fid:s,label:a,parentId:void 0,expanded:!0,img:"./static/radar-small.png"};var m,l=i[a];for(m in o+=1,l){var d=GSTCID(String(o));rrows[d]={sid:d,label:m,parentId:s,expanded:!1,img:"./static/SATELLITE-small.png"};var c,u=l[m];for(c in u){var p={id:String(n++),label:a+"-"+m,rowId:String(o),time:{start:GSTC.api.date(u[c].time).valueOf(),end:GSTC.api.date(u[c].time).add(parseInt(u[c].duration),"second").valueOf()}};iitems.push(p)}o+=1}}r={zoom:12,period:"hour",from:GSTC.api.date(t).startOf("hour").valueOf(),to:GSTC.api.date(r).endOf("hour").valueOf()},r={items:GSTC.api.fromArray(iitems),calendarLevels:[hours,minutes],time:r},r={licenseKey:licensePublic,list:{columns:{data:GSTC.api.fromArray(columnsFromDB)},rows:rrows},chart:r,slots:{"chart-timeline-items-row-item":{inner:[itemSlot]},"list-column-row":{content:[rowSlot]}}};sstate=GSTC.api.stateFromConfig(r),GSTC({element:document.getElementById("gstc"),state:sstate})}),new Slider("#ex1",{formatter:function(t){return"Current value: "+t}}).on("slide",function(t){sstate.update("config.chart.time.zoom",t)}).on("change",function(t){sstate.update("config.chart.time.zoom",t.newValue)})});