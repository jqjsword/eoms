define(["./Cartesian2-716c2715","./EllipsoidTangentPlane-8e486e83","./Transforms-f1816abc","./when-208fe5b0","./Check-d18af7c4","./TerrainEncoding-54905cbb","./Math-3ba16bed","./OrientedBoundingBox-45cb4e24","./WebMercatorProjection-3b6236c8","./RuntimeError-7f634f5d","./createTaskProcessorWorker","./IntersectionTests-680c4e46","./Plane-f5dfabcd","./AttributeCompression-69c5b20c","./ComponentDatatype-549ec0d3","./WebGLConstants-76bb35d1"],function(Se,Pe,Ee,Ce,Fe,Le,Oe,Ne,Re,n,e,t,i,r,a,s){"use strict";var l=Object.freeze({NONE:0,LERC:1}),ze={};ze.DEFAULT_STRUCTURE=Object.freeze({heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1});var He=new Se.Cartesian3,_e=new Ee.Matrix4,Ye=new Se.Cartesian3,We=new Se.Cartesian3;ze.computeVertices=function(e){if(!Ce.defined(e)||!Ce.defined(e.heightmap))throw new Fe.DeveloperError("options.heightmap is required.");if(!Ce.defined(e.width)||!Ce.defined(e.height))throw new Fe.DeveloperError("options.width and options.height are required.");if(!Ce.defined(e.nativeRectangle))throw new Fe.DeveloperError("options.nativeRectangle is required.");if(!Ce.defined(e.skirtHeight))throw new Fe.DeveloperError("options.skirtHeight is required.");var t,i,r,a=Math.cos,n=Math.sin,s=Math.sqrt,l=Math.atan,o=Math.exp,f=Oe.CesiumMath.PI_OVER_TWO,u=Oe.CesiumMath.toRadians,d=e.heightmap,c=e.width,h=e.height,m=e.skirtHeight,g=Ce.defaultValue(e.isGeographic,!0),p=Ce.defaultValue(e.ellipsoid,Se.Ellipsoid.WGS84),w=1/p.maximumRadius,x=e.nativeRectangle,k=e.rectangle,y=Ce.defined(k)?(t=k.west,i=k.south,r=k.east,k.north):g?(t=u(x.west),i=u(x.south),r=u(x.east),u(x.north)):(t=x.west*w,i=f-2*l(o(-x.south*w)),r=x.east*w,f-2*l(o(-x.north*w))),b=e.relativeToCenter,I=Ce.defined(b),b=I?b:Se.Cartesian3.ZERO,v=Ce.defaultValue(e.exaggeration,1),U=Ce.defaultValue(e.includeWebMercatorT,!1),T=Ce.defaultValue(e.structure,ze.DEFAULT_STRUCTURE),M=Ce.defaultValue(T.heightScale,ze.DEFAULT_STRUCTURE.heightScale),V=Ce.defaultValue(T.heightOffset,ze.DEFAULT_STRUCTURE.heightOffset),A=Ce.defaultValue(T.elementsPerHeight,ze.DEFAULT_STRUCTURE.elementsPerHeight),D=Ce.defaultValue(T.stride,ze.DEFAULT_STRUCTURE.stride),B=Ce.defaultValue(T.elementMultiplier,ze.DEFAULT_STRUCTURE.elementMultiplier),S=Ce.defaultValue(T.isBigEndian,ze.DEFAULT_STRUCTURE.isBigEndian),P=Se.Rectangle.computeWidth(x),E=Se.Rectangle.computeHeight(x),C=P/(c-1),F=E/(h-1);g||(P*=w,E*=w);var L,O,e=p.radiiSquared,N=e.x,R=e.y,z=e.z,H=65536,_=-65536,T=Ee.Transforms.eastNorthUpToFixedFrame(b,p),Y=Ee.Matrix4.inverseTransformation(T,_e);U&&(L=Re.WebMercatorProjection.geodeticLatitudeToMercatorAngle(i),O=1/(Re.WebMercatorProjection.geodeticLatitudeToMercatorAngle(y)-L));var W=Ye;W.x=Number.POSITIVE_INFINITY,W.y=Number.POSITIVE_INFINITY,W.z=Number.POSITIVE_INFINITY;var X=We;X.x=Number.NEGATIVE_INFINITY,X.y=Number.NEGATIVE_INFINITY,X.z=Number.NEGATIVE_INFINITY;var Z=Number.POSITIVE_INFINITY,j=c*h,q=j+(0<m?2*c+2*h:0),G=new Array(q),Q=new Array(q),J=new Array(q),K=U?new Array(q):[],$=0,ee=h,te=0,ie=c;0<m&&(--$,++ee,--te,++ie);for(var re=$;re<ee;++re){var ae=re;h<=(ae=ae<0?0:ae)&&(ae=h-1);var ne=x.north-F*ae,se=((ne=g?u(ne):f-2*l(o(-ne*w)))-i)/(y-i),se=Oe.CesiumMath.clamp(se,0,1),le=re===$,oe=re===ee-1;0<m&&(le?ne+=1e-5*E:oe&&(ne-=1e-5*E));var fe,ue=a(ne),de=n(ne),ce=z*de;U&&(fe=(Re.WebMercatorProjection.geodeticLatitudeToMercatorAngle(ne)-L)*O);for(var he=te;he<ie;++he){var me=he,ge=ae*(c*D)+(me=c<=(me=me<0?0:me)?c-1:me)*D;if(1===A)we=d[ge];else{var pe,we=0;if(S)for(pe=0;pe<A;++pe)we=we*B+d[ge+pe];else for(pe=A-1;0<=pe;--pe)we=we*B+d[ge+pe]}we=(we*M+V)*v;var _=Math.max(_,we),H=Math.min(H,we),xe=x.west+C*me;g?xe=u(xe):xe*=w;var ke=(xe-t)/(r-t),ke=Oe.CesiumMath.clamp(ke,0,1),ye=ae*c+me;if(0<m){var be=he===te,Ie=he===ie-1,ve=le||oe||be||Ie;if((le||oe)&&(be||Ie))continue;ve&&(we-=m,be?(ye=h-ae-1+j,xe-=1e-5*P):oe?ye=j+h+(c-me-1):Ie?(ye=j+h+c+ae,xe+=1e-5*P):le&&(ye=j+h+c+h+me))}var Ue=ue*a(xe),ve=ue*n(xe),be=N*Ue,Ie=R*ve,me=1/s(be*Ue+Ie*ve+ce*de),xe=be*me,be=Ie*me,Ie=ce*me,me=new Se.Cartesian3;me.x=xe+Ue*we,me.y=be+ve*we,me.z=Ie+de*we,G[ye]=me,Q[ye]=we,J[ye]=new Se.Cartesian2(ke,se),U&&(K[ye]=fe),Ee.Matrix4.multiplyByPoint(Y,me,He),Se.Cartesian3.minimumByComponent(He,W,W),Se.Cartesian3.maximumByComponent(He,X,X),Z=Math.min(Z,we)}}var Te,Me,e=Ee.BoundingSphere.fromPoints(G);Ce.defined(k)&&(Te=Ne.OrientedBoundingBox.fromRectangle(k,H,_,p)),I&&(Me=new Le.EllipsoidalOccluder(p).computeHorizonCullingPointPossiblyUnderEllipsoid(b,G,H));for(var b=new Pe.AxisAlignedBoundingBox(W,X,b),Ve=new Le.TerrainEncoding(b,Z,_,T,!1,U),Ae=new Float32Array(q*Ve.getStride()),De=0,Be=0;Be<q;++Be)De=Ve.encode(Ae,De,G[Be],J[Be],Q[Be],void 0,K[Be]);return{vertices:Ae,maximumHeight:_,minimumHeight:H,encoding:Ve,boundingSphere3D:e,orientedBoundingBox:Te,occludeePointInScaledSpace:Me}};var o,f,u,d,c,D,h,w,x,k,m,g={};o={defaultNoDataValue:-34027999387901484e22,decode:function(e,t){var i=(t=t||{}).encodedMaskData||null===t.encodedMaskData,r=c(e,t.inputOffset||0,i),e=null!==t.noDataValue?t.noDataValue:o.defaultNoDataValue,i=f(r,t.pixelType||Float32Array,t.encodedMaskData,e,t.returnMask),e={width:r.width,height:r.height,pixelData:i.resultPixels,minValue:i.minValue,maxValue:r.pixels.maxValue,noDataValue:e};return i.resultMask&&(e.maskData=i.resultMask),t.returnEncodedMask&&r.mask&&(e.encodedMaskData=r.mask.bitset||null),t.returnFileInfo&&(e.fileInfo=u(r),t.computeUsedBitDepths&&(e.fileInfo.bitDepths=d(r))),e}},f=function(e,t,i,r,a){var n,s,l,o=0,f=e.pixels.numBlocksX,u=e.pixels.numBlocksY,d=Math.floor(e.width/f),c=Math.floor(e.height/u),h=2*e.maxZError,m=Number.MAX_VALUE;i=i||(e.mask?e.mask.bitset:null),s=new t(e.width*e.height),a&&i&&(l=new Uint8Array(e.width*e.height));for(var g,p,w=new Float32Array(d*c),x=0;x<=u;x++){var k=x!==u?c:e.height%u;if(0!==k)for(var y=0;y<=f;y++){var b=y!==f?d:e.width%f;if(0!==b){var I,v,U,T,M=x*e.width*c+y*d,V=e.width-b,A=e.pixels.blocks[o];if(A.encoding<2?(I=0===A.encoding?A.rawData:(D(A.stuffedData,A.bitsPerPixel,A.numValidPixels,A.offset,h,w,e.pixels.maxValue),w),v=0):U=2===A.encoding?0:A.offset,i)for(p=0;p<k;p++){for(7&M&&(T=i[M>>3],T<<=7&M),g=0;g<b;g++)128&(T=!(7&M)?i[M>>3]:T)?(l&&(l[M]=1),m=(n=A.encoding<2?I[v++]:U)<m?n:m,s[M++]=n):(l&&(l[M]=0),s[M++]=r),T<<=1;M+=V}else if(A.encoding<2)for(p=0;p<k;p++){for(g=0;g<b;g++)m=(n=I[v++])<m?n:m,s[M++]=n;M+=V}else for(m=U<m?U:m,p=0;p<k;p++){for(g=0;g<b;g++)s[M++]=U;M+=V}if(1===A.encoding&&v!==A.numValidPixels)throw"Block and Mask do not match";o++}}}return{resultPixels:s,resultMask:l,minValue:m}},u=function(e){return{fileIdentifierString:e.fileIdentifierString,fileVersion:e.fileVersion,imageType:e.imageType,height:e.height,width:e.width,maxZError:e.maxZError,eofOffset:e.eofOffset,mask:e.mask?{numBlocksX:e.mask.numBlocksX,numBlocksY:e.mask.numBlocksY,numBytes:e.mask.numBytes,maxValue:e.mask.maxValue}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,numBytes:e.pixels.numBytes,maxValue:e.pixels.maxValue,noDataValue:e.noDataValue}}},d=function(e){for(var t=e.pixels.numBlocksX*e.pixels.numBlocksY,i={},r=0;r<t;r++){var a=e.pixels.blocks[r];0===a.encoding?i.float32=!0:1===a.encoding?i[a.bitsPerPixel]=!0:i[0]=!0}return Object.keys(i)},c=function(e,t,i){var r={},a=new Uint8Array(e,t,10);if(r.fileIdentifierString=String.fromCharCode.apply(null,a),"CntZImage"!==r.fileIdentifierString.trim())throw"Unexpected file identifier string: "+r.fileIdentifierString;t+=10;var n=new DataView(e,t,24);if(r.fileVersion=n.getInt32(0,!0),r.imageType=n.getInt32(4,!0),r.height=n.getUint32(8,!0),r.width=n.getUint32(12,!0),r.maxZError=n.getFloat64(16,!0),t+=24,!i)if(n=new DataView(e,t,16),r.mask={},r.mask.numBlocksY=n.getUint32(0,!0),r.mask.numBlocksX=n.getUint32(4,!0),r.mask.numBytes=n.getUint32(8,!0),r.mask.maxValue=n.getFloat32(12,!0),t+=16,0<r.mask.numBytes){var s=new Uint8Array(Math.ceil(r.width*r.height/8)),l=(n=new DataView(e,t,r.mask.numBytes)).getInt16(0,!0),o=2,f=0;do{if(0<l)for(;l--;)s[f++]=n.getUint8(o++);else for(var u=n.getUint8(o++),l=-l;l--;)s[f++]=u}while(l=n.getInt16(o,!0),(o+=2)<r.mask.numBytes);if(-32768!==l||f<s.length)throw"Unexpected end of mask RLE encoding";r.mask.bitset=s,t+=r.mask.numBytes}else 0==(r.mask.numBytes|r.mask.numBlocksY|r.mask.maxValue)&&(r.mask.bitset=new Uint8Array(Math.ceil(r.width*r.height/8)));n=new DataView(e,t,16),r.pixels={},r.pixels.numBlocksY=n.getUint32(0,!0),r.pixels.numBlocksX=n.getUint32(4,!0),r.pixels.numBytes=n.getUint32(8,!0),r.pixels.maxValue=n.getFloat32(12,!0),t+=16;var a=r.pixels.numBlocksX,i=r.pixels.numBlocksY,d=a+(0<r.width%a?1:0),c=i+(0<r.height%i?1:0);r.pixels.blocks=new Array(d*c);for(var h=0,m=0;m<c;m++)for(var g=0;g<d;g++){var p=0,w=e.byteLength-t;n=new DataView(e,t,Math.min(10,w));var x={};r.pixels.blocks[h++]=x;var k,w=n.getUint8(0);if(p++,x.encoding=63&w,3<x.encoding)throw"Invalid block encoding ("+x.encoding+")";if(2!==x.encoding){if(0!==w&&2!==w){if(w>>=6,2===(x.offsetType=w))x.offset=n.getInt8(1),p++;else if(1===w)x.offset=n.getInt16(1,!0),p+=2;else{if(0!==w)throw"Invalid block offset type";x.offset=n.getFloat32(1,!0),p+=4}if(1===x.encoding)if(w=n.getUint8(p),p++,x.bitsPerPixel=63&w,w>>=6,2===(x.numValidPixelsType=w))x.numValidPixels=n.getUint8(p),p++;else if(1===w)x.numValidPixels=n.getUint16(p,!0),p+=2;else{if(0!==w)throw"Invalid valid pixel count type";x.numValidPixels=n.getUint32(p,!0),p+=4}}if(t+=p,3!==x.encoding)if(0===x.encoding){var y=(r.pixels.numBytes-1)/4;if(y!==Math.floor(y))throw"uncompressed block has invalid length";k=new ArrayBuffer(4*y),new Uint8Array(k).set(new Uint8Array(e,t,4*y));var b=new Float32Array(k);x.rawData=b,t+=4*y}else 1===x.encoding&&(b=Math.ceil(x.numValidPixels*x.bitsPerPixel/8),y=Math.ceil(b/4),k=new ArrayBuffer(4*y),new Uint8Array(k).set(new Uint8Array(e,t,b)),x.stuffedData=new Uint32Array(k),t+=b)}else t++}return r.eofOffset=t,r},D=function(e,t,i,r,a,n,s){var l,o,f,u,d=(1<<t)-1,c=0,h=0,m=Math.ceil((s-r)/a),g=4*e.length-Math.ceil(t*i/8);for(e[e.length-1]<<=8*g,l=0;l<i;l++)0===h&&(u=e[c++],h=32),t<=h?(f=u>>>h-t&d,h-=t):(f=(u&d)<<(o=t-h)&d,f+=(u=e[c++])>>>(h=32-o)),n[l]=f<m?r+f*a:s;return n},w=o,x=function(){var y=function(e,t,i,r,a,n,s,l){var o,f,u,d,c,h=(1<<i)-1,m=0,g=0,p=4*e.length-Math.ceil(i*r/8);if(e[e.length-1]<<=8*p,a)for(o=0;o<r;o++)0===g&&(u=e[m++],g=32),i<=g?(f=u>>>g-i&h,g-=i):(f=(u&h)<<(d=i-g)&h,f+=(u=e[m++])>>>(g=32-d)),t[o]=a[f];else for(c=Math.ceil((l-n)/s),o=0;o<r;o++)0===g&&(u=e[m++],g=32),i<=g?(f=u>>>g-i&h,g-=i):(f=(u&h)<<(d=i-g)&h,f+=(u=e[m++])>>>(g=32-d)),t[o]=f<c?n+f*s:l},b=function(e,t,i,r,a,n){var s,l,o=(1<<t)-1,f=0,u=0,d=0,c=0,h=[],m=4*e.length-Math.ceil(t*i/8);e[e.length-1]<<=8*m;for(var g=Math.ceil((n-r)/a),u=0;u<i;u++)0===d&&(l=e[f++],d=32),t<=d?(c=l>>>d-t&o,d-=t):(c=(l&o)<<(s=t-d)&o,c+=(l=e[f++])>>>(d=32-s)),h[u]=c<g?r+c*a:n;return h.unshift(r),h},I=function(e,t,i,r,a,n,s,l){var o,f,u,d=(1<<i)-1,c=0,h=0,m=0;if(a)for(p=0;p<r;p++)0===h&&(f=e[c++],h=32,m=0),i<=h?(o=f>>>m&d,h-=i,m+=i):(o=f>>>m&d,h=32-(u=i-h),o|=((f=e[c++])&(1<<u)-1)<<i-u,m=u),t[p]=a[o];else for(var g=Math.ceil((l-n)/s),p=0;p<r;p++)0===h&&(f=e[c++],h=32,m=0),i<=h?(o=f>>>m&d,h-=i,m+=i):(o=f>>>m&d,h=32-(u=i-h),o|=((f=e[c++])&(1<<u)-1)<<i-u,m=u),t[p]=o<g?n+o*s:l;return t},v=function(e,t,i,r,a,n){for(var s,l,o=(1<<t)-1,f=0,u=0,d=0,c=0,h=0,m=[],g=Math.ceil((n-r)/a),u=0;u<i;u++)0===d&&(l=e[f++],d=32,h=0),t<=d?(c=l>>>h&o,d-=t,h+=t):(c=l>>>h&o,d=32-(s=t-d),c|=((l=e[f++])&(1<<s)-1)<<t-s,h=s),m[u]=c<g?r+c*a:n;return m.unshift(r),m},U=function(e,t,i,r){var a,n,s,l,o=(1<<i)-1,f=0,u=0,d=4*e.length-Math.ceil(i*r/8);for(e[e.length-1]<<=8*d,a=0;a<r;a++)0===u&&(s=e[f++],u=32),i<=u?(n=s>>>u-i&o,u-=i):(n=(s&o)<<(l=i-u)&o,n+=(s=e[f++])>>>(u=32-l)),t[a]=n;return t},T=function(e,t,i,r){for(var a,n,s,l=(1<<i)-1,o=0,f=0,u=0,d=0;d<r;d++)0===f&&(n=e[o++],f=32,u=0),i<=f?(a=n>>>u&l,f-=i,u+=i):(a=n>>>u&l,f=32-(s=i-f),a|=((n=e[o++])&(1<<s)-1)<<i-s,u=s),t[d]=a;return t},R={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(e){for(var t=65535,i=65535,r=e.length,a=Math.floor(r/2),n=0;a;){var s=359<=a?359:a;for(a-=s;t+=e[n++]<<8,i+=t+=e[n++],--s;);t=(65535&t)+(t>>>16),i=(65535&i)+(i>>>16)}return 1&r&&(i+=t+=e[n]<<8),((i=(65535&i)+(i>>>16))<<16|(t=(65535&t)+(t>>>16)))>>>0},readHeaderInfo:function(e,t){var i=t.ptr,r=new Uint8Array(e,i,6),a={};if(a.fileIdentifierString=String.fromCharCode.apply(null,r),0!==a.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+a.fileIdentifierString;i+=6;var n=new DataView(e,i,8),r=n.getInt32(0,!0);if(a.fileVersion=r,i+=4,3<=r&&(a.checksum=n.getUint32(4,!0),i+=4),n=new DataView(e,i,12),a.height=n.getUint32(0,!0),a.width=n.getUint32(4,!0),i+=8,4<=r?(a.numDims=n.getUint32(8,!0),i+=4):a.numDims=1,n=new DataView(e,i,40),a.numValidPixel=n.getUint32(0,!0),a.microBlockSize=n.getInt32(4,!0),a.blobSize=n.getInt32(8,!0),a.imageType=n.getInt32(12,!0),a.maxZError=n.getFloat64(16,!0),a.zMin=n.getFloat64(24,!0),a.zMax=n.getFloat64(32,!0),i+=40,t.headerInfo=a,t.ptr=i,3<=r&&(r=4<=r?52:48,this.computeChecksumFletcher32(new Uint8Array(e,i-r,a.blobSize-14))!==a.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(e,t){var i=t.headerInfo,r=this.getDataTypeArray(i.imageType),a=i.numDims*this.getDataTypeSize(i.imageType),n=this.readSubArray(e,t.ptr,r,a),s=this.readSubArray(e,t.ptr+a,r,a);t.ptr+=2*a;for(var l=!0,o=0;o<i.numDims;o++)if(n[o]!==s[o]){l=!1;break}return i.minValues=n,i.maxValues=s,l},readSubArray:function(e,t,i,r){var a=i===Uint8Array?new Uint8Array(e,t,r):(a=new ArrayBuffer(r),new Uint8Array(a).set(new Uint8Array(e,t,r)),new i(a));return a},readMask:function(e,t){var i=t.ptr,r=t.headerInfo,a=r.width*r.height,r=r.numValidPixel,n=new DataView(e,i,4),s={};if(s.numBytes=n.getUint32(0,!0),i+=4,(0===r||a===r)&&0!==s.numBytes)throw"invalid mask";if(0===r)o=new Uint8Array(Math.ceil(a/8)),s.bitset=o,c=new Uint8Array(a),t.pixels.resultMask=c,i+=s.numBytes;else if(0<s.numBytes){var l,o=new Uint8Array(Math.ceil(a/8)),f=(n=new DataView(e,i,s.numBytes)).getInt16(0,!0),u=2,d=0;do{if(0<f)for(;f--;)o[d++]=n.getUint8(u++);else for(l=n.getUint8(u++),f=-f;f--;)o[d++]=l}while(f=n.getInt16(u,!0),(u+=2)<s.numBytes);if(-32768!==f||d<o.length)throw"Unexpected end of mask RLE encoding";for(var c=new Uint8Array(a),h=0,m=0,m=0;m<a;m++)7&m?(h=o[m>>3],h<<=7&m):h=o[m>>3],128&h&&(c[m]=1);t.pixels.resultMask=c,s.bitset=o,i+=s.numBytes}return t.ptr=i,t.mask=s,!0},readDataOneSweep:function(e,t,i){var r=t.ptr,a=t.headerInfo,n=a.numDims,s=a.width*a.height,l=a.imageType,a=a.numValidPixel*R.getDataTypeSize(l)*n,o=t.pixels.resultMask,f=i===Uint8Array?new Uint8Array(e,r,a):(l=new ArrayBuffer(a),new Uint8Array(l).set(new Uint8Array(e,r,a)),new i(l));if(f.length===s*n)t.pixels.resultPixels=f;else{t.pixels.resultPixels=new i(s*n);var u,d=0,c=0,h=0;if(1<n)for(h=0;h<n;h++)for(u=h*s,c=0;c<s;c++)o[c]&&(t.pixels.resultPixels[u+c]=f[d++]);else for(c=0;c<s;c++)o[c]&&(t.pixels.resultPixels[c]=f[d++])}return r+=a,t.ptr=r,!0},readHuffmanTree:function(e,t){var i=this.HUFFMAN_LUT_BITS_MAX,r=new DataView(e,t.ptr,16);if(t.ptr+=16,r.getInt32(0,!0)<2)throw"unsupported Huffman version";var a=r.getInt32(4,!0),n=r.getInt32(8,!0),s=r.getInt32(12,!0);if(s<=n)return!1;var l=new Uint32Array(s-n);R.decodeBits(e,t,l);for(var o,f,u,d=[],c=n;c<s;c++)d[o=c-(c<a?0:a)]={first:l[c-n],second:null};var h=e.byteLength-t.ptr,r=Math.ceil(h/4),r=new ArrayBuffer(4*r);new Uint8Array(r).set(new Uint8Array(e,t.ptr,h));var m=new Uint32Array(r),g=0,p=0,w=m[0];for(c=n;c<s;c++)0<(u=d[o=c-(c<a?0:a)].first)&&(d[o].second=w<<g>>>32-u,u<=32-g?32===(g+=u)&&(g=0,w=m[++p]):(g+=u-32,w=m[++p],d[o].second|=w>>>32-g));var x=0,k=0,y=new V;for(c=0;c<d.length;c++)void 0!==d[c]&&(x=Math.max(x,d[c].first));k=i<=x?i:x,30<=x&&console.log("WARning, large NUM LUT BITS IS "+x);var b,I,v,U,T,M=[];for(c=n;c<s;c++)if(0<(u=d[o=c-(c<a?0:a)].first))if(b=[u,o],u<=k)for(I=d[o].second<<k-u,v=1<<k-u,f=0;f<v;f++)M[I|f]=b;else for(I=d[o].second,T=y,U=u-1;0<=U;U--)T=I>>>U&1?(T.right||(T.right=new V),T.right):(T.left||(T.left=new V),T.left),0!==U||T.val||(T.val=b[1]);return{decodeLut:M,numBitsLUTQick:k,numBitsLUT:x,tree:y,stuffedData:m,srcPtr:p,bitPos:g}},readHuffman:function(e,t,i){var r,a,n,s,l,o,f,u,d,c=t.headerInfo,h=c.numDims,m=t.headerInfo.height,g=t.headerInfo.width,p=g*m,e=this.readHuffmanTree(e,t),w=e.decodeLut,x=e.tree,k=e.stuffedData,y=e.srcPtr,b=e.bitPos,I=e.numBitsLUTQick,v=e.numBitsLUT,U=0===t.headerInfo.imageType?128:0,T=t.pixels.resultMask,M=0;0<b&&(y++,b=0);for(var V=k[y],A=1===t.encodeMode,D=new i(p*h),B=D,S=0;S<c.numDims;S++){if(1<h&&(B=new i(D.buffer,p*S,p),M=0),t.headerInfo.numValidPixel===g*m)for(o=u=0;o<m;o++)for(f=0;f<g;f++,u++){if(a=0,l=s=V<<b>>>32-I,w[l=32-b<I?s|=k[y+1]>>>64-b-I:l])a=w[l][1],b+=w[l][0];else for(l=s=V<<b>>>32-v,32-b<v&&(l=s|=k[y+1]>>>64-b-v),r=x,d=0;d<v;d++)if(!(r=s>>>v-d-1&1?r.right:r.left).left&&!r.right){a=r.val,b=b+d+1;break}32<=b&&(b-=32,V=k[++y]),n=a-U,A?(n+=!(0<f)&&0<o?B[u-g]:M,n&=255,M=B[u]=n):B[u]=n}else for(o=u=0;o<m;o++)for(f=0;f<g;f++,u++)if(T[u]){if(a=0,l=s=V<<b>>>32-I,w[l=32-b<I?s|=k[y+1]>>>64-b-I:l])a=w[l][1],b+=w[l][0];else for(l=s=V<<b>>>32-v,32-b<v&&(l=s|=k[y+1]>>>64-b-v),r=x,d=0;d<v;d++)if(!(r=s>>>v-d-1&1?r.right:r.left).left&&!r.right){a=r.val,b=b+d+1;break}32<=b&&(b-=32,V=k[++y]),n=a-U,A?(!(0<f&&T[u-1])&&0<o&&T[u-g]?n+=B[u-g]:n+=M,n&=255,M=B[u]=n):B[u]=n}t.ptr=t.ptr+4*(y+1)+(0<b?4:0)}t.pixels.resultPixels=D},decodeBits:function(e,t,i,r,a){var n=t.headerInfo,s=n.fileVersion,l=0,o=5<=e.byteLength-t.ptr?5:e.byteLength-t.ptr,f=new DataView(e,t.ptr,o),u=f.getUint8(0);l++;var d=u>>6,c=0==d?4:3-d,o=0<(32&u),d=31&u,u=0;if(1==c)u=f.getUint8(l),l++;else if(2==c)u=f.getUint16(l,!0),l+=2;else{if(4!=c)throw"Invalid valid pixel count type";u=f.getUint32(l,!0),l+=4}var h,m,g,p,w,x,k,c=2*n.maxZError,n=1<n.numDims?n.maxValues[a]:n.zMax;if(o){for(t.counter.lut++,x=f.getUint8(l),l++,p=Math.ceil((x-1)*d/8),w=Math.ceil(p/4),m=new ArrayBuffer(4*w),g=new Uint8Array(m),t.ptr+=l,g.set(new Uint8Array(e,t.ptr,p)),f=new Uint32Array(m),t.ptr+=p,k=0;x-1>>>k;)k++;p=Math.ceil(u*k/8),w=Math.ceil(p/4),m=new ArrayBuffer(4*w),(g=new Uint8Array(m)).set(new Uint8Array(e,t.ptr,p)),h=new Uint32Array(m),t.ptr+=p,f=(3<=s?v:b)(f,d,x-1,r,c,n),(3<=s?I:y)(h,i,k,u,f)}else t.counter.bitstuffer++,k=d,t.ptr+=l,0<k&&(p=Math.ceil(u*k/8),w=Math.ceil(p/4),m=new ArrayBuffer(4*w),(g=new Uint8Array(m)).set(new Uint8Array(e,t.ptr,p)),h=new Uint32Array(m),t.ptr+=p,3<=s?null===r?T(h,i,k,u):I(h,i,k,u,!1,r,c,n):null===r?U(h,i,k,u):y(h,i,k,u,!1,r,c,n))},readTiles:function(e,t,i){var r=t.headerInfo,a=r.width,n=r.height,s=r.microBlockSize,l=r.imageType,o=R.getDataTypeSize(l),f=Math.ceil(a/s),u=Math.ceil(n/s);t.pixels.numBlocksY=u,t.pixels.numBlocksX=f;for(var d,c,h,m,g,p,w,x,k,y,b,I,v,U,T=t.pixels.ptr=0,M=0,V=0,A=0,D=0,B=0,S=0,P=0,E=new i(s*s),C=n%s||s,F=a%s||s,L=r.numDims,O=t.pixels.resultMask,N=t.pixels.resultPixels,V=0;V<u;V++)for(d=V!==u-1?s:C,A=0;A<f;A++)for(D=V*a*s+A*s,p=a-(c=A!==f-1?s:F),U=0;U<L;U++){if(1<L&&(N=new i(t.pixels.resultPixels.buffer,a*n*U*o,a*n)),h=e.byteLength-t.ptr,k={},P=0,P++,g=(m=(x=new DataView(e,t.ptr,Math.min(10,h))).getUint8(0))>>6&255,(m>>2&15)!=(A*s>>3&15))throw"integrity issue";if(3<(b=3&m))throw t.ptr+=P,"Invalid block encoding ("+b+")";if(2!=b)if(0==b){if(t.counter.uncompressed++,t.ptr+=P,B=(B=d*c*o)<(w=e.byteLength-t.ptr)?B:w,I=new ArrayBuffer(B%o==0?B:B+o-B%o),new Uint8Array(I).set(new Uint8Array(e,t.ptr,B)),y=new i(I),S=0,O)for(T=0;T<d;T++){for(M=0;M<c;M++)O[D]&&(N[D]=y[S++]),D++;D+=p}else for(T=0;T<d;T++){for(M=0;M<c;M++)N[D++]=y[S++];D+=p}t.ptr+=S*o}else if(I=R.getDataTypeUsed(l,g),v=R.getOnePixel(k,P,I,x),P+=R.getDataTypeSize(I),3==b)if(t.ptr+=P,t.counter.constantoffset++,O)for(T=0;T<d;T++){for(M=0;M<c;M++)O[D]&&(N[D]=v),D++;D+=p}else for(T=0;T<d;T++){for(M=0;M<c;M++)N[D++]=v;D+=p}else if(t.ptr+=P,R.decodeBits(e,t,E,v,U),P=0,O)for(T=0;T<d;T++){for(M=0;M<c;M++)O[D]&&(N[D]=E[P++]),D++;D+=p}else for(T=0;T<d;T++){for(M=0;M<c;M++)N[D++]=E[P++];D+=p}else t.counter.constant++,t.ptr+=P}},formatFileInfo:function(e){return{fileIdentifierString:e.headerInfo.fileIdentifierString,fileVersion:e.headerInfo.fileVersion,imageType:e.headerInfo.imageType,height:e.headerInfo.height,width:e.headerInfo.width,numValidPixel:e.headerInfo.numValidPixel,microBlockSize:e.headerInfo.microBlockSize,blobSize:e.headerInfo.blobSize,maxZError:e.headerInfo.maxZError,pixelType:R.getPixelType(e.headerInfo.imageType),eofOffset:e.eofOffset,mask:e.mask?{numBytes:e.mask.numBytes}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,maxValue:e.headerInfo.zMax,minValue:e.headerInfo.zMin,noDataValue:e.noDataValue}}},constructConstantSurface:function(e){var t,i=e.headerInfo.zMax,r=e.headerInfo.numDims,a=e.headerInfo.height*e.headerInfo.width,n=a*r,s=0,l=0,o=e.pixels.resultMask;if(o)if(1<r)for(s=0;s<r;s++)for(t=s*a,l=0;l<a;l++)o[l]&&(e.pixels.resultPixels[t+l]=i);else for(l=0;l<a;l++)o[l]&&(e.pixels.resultPixels[l]=i);else if(e.pixels.resultPixels.fill)e.pixels.resultPixels.fill(i);else for(l=0;l<n;l++)e.pixels.resultPixels[l]=i},getDataTypeArray:function(e){var t;switch(e){case 0:t=Int8Array;break;case 1:t=Uint8Array;break;case 2:t=Int16Array;break;case 3:t=Uint16Array;break;case 4:t=Int32Array;break;case 5:t=Uint32Array;break;case 6:t=Float32Array;break;case 7:t=Float64Array;break;default:t=Float32Array}return t},getPixelType:function(e){var t;switch(e){case 0:t="S8";break;case 1:t="U8";break;case 2:t="S16";break;case 3:t="U16";break;case 4:t="S32";break;case 5:t="U32";break;case 6:t="F32";break;case 7:t="F64";break;default:t="F32"}return t},isValidPixelValue:function(e,t){if(null===t)return!1;var i;switch(e){case 0:i=-128<=t&&t<=127;break;case 1:i=0<=t&&t<=255;break;case 2:i=-32768<=t&&t<=32767;break;case 3:i=0<=t&&t<=65536;break;case 4:i=-2147483648<=t&&t<=2147483647;break;case 5:i=0<=t&&t<=4294967296;break;case 6:i=-34027999387901484e22<=t&&t<=34027999387901484e22;break;case 7:i=5e-324<=t&&t<=17976931348623157e292;break;default:i=!1}return i},getDataTypeSize:function(e){var t=0;switch(e){case 0:case 1:t=1;break;case 2:case 3:t=2;break;case 4:case 5:case 6:t=4;break;case 7:t=8;break;default:t=e}return t},getDataTypeUsed:function(e,t){var i=e;switch(e){case 2:case 4:i=e-t;break;case 3:case 5:i=e-2*t;break;case 6:i=0===t?e:1===t?2:1;break;case 7:i=0===t?e:e-2*t+1;break;default:i=e}return i},getOnePixel:function(e,t,i,r){var a=0;switch(i){case 0:a=r.getInt8(t);break;case 1:a=r.getUint8(t);break;case 2:a=r.getInt16(t,!0);break;case 3:a=r.getUint16(t,!0);break;case 4:a=r.getInt32(t,!0);break;case 5:a=r.getUInt32(t,!0);break;case 6:a=r.getFloat32(t,!0);break;case 7:a=r.getFloat64(t,!0);break;default:throw"the decoder does not understand this pixel type"}return a}},V=function(e,t,i){this.val=e,this.left=t,this.right=i};return{decode:function(e,t){var i=(t=t||{}).noDataValue,r=0,a={};if(a.ptr=t.inputOffset||0,a.pixels={},R.readHeaderInfo(e,a)){var n=a.headerInfo,s=n.fileVersion,l=R.getDataTypeArray(n.imageType);R.readMask(e,a),n.numValidPixel===n.width*n.height||a.pixels.resultMask||(a.pixels.resultMask=t.maskData);var o,f=n.width*n.height;if(a.pixels.resultPixels=new l(f*n.numDims),a.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0},0!==n.numValidPixel)if(n.zMax===n.zMin)R.constructConstantSurface(a);else if(4<=s&&R.checkMinMaxRanges(e,a))R.constructConstantSurface(a);else{var u=new DataView(e,a.ptr,2),d=u.getUint8(0);if(a.ptr++,d)R.readDataOneSweep(e,a,l);else if(1<s&&n.imageType<=1&&Math.abs(n.maxZError-.5)<1e-5){u=u.getUint8(1);if(a.ptr++,2<(a.encodeMode=u)||s<4&&1<u)throw"Invalid Huffman flag "+u;u?R.readHuffman(e,a,l):R.readTiles(e,a,l)}else R.readTiles(e,a,l)}a.eofOffset=a.ptr,t.inputOffset?(o=a.headerInfo.blobSize+t.inputOffset-a.ptr,1<=Math.abs(o)&&(a.eofOffset=t.inputOffset+a.headerInfo.blobSize)):(o=a.headerInfo.blobSize-a.ptr,1<=Math.abs(o)&&(a.eofOffset=a.headerInfo.blobSize));var c={width:n.width,height:n.height,pixelData:a.pixels.resultPixels,minValue:n.zMin,maxValue:n.zMax,validPixelCount:n.numValidPixel,dimCount:n.numDims,dimStats:{minValues:n.minValues,maxValues:n.maxValues},maskData:a.pixels.resultMask};if(a.pixels.resultMask&&R.isValidPixelValue(n.imageType,i)){for(var h=a.pixels.resultMask,r=0;r<f;r++)h[r]||(c.pixelData[r]=i);c.noDataValue=i}return a.noDataValue=i,t.returnFileInfo&&(c.fileInfo=R.formatFileInfo(a)),c}},getBandCount:function(e){for(var t=0,i=0,r={ptr:0,pixels:{}};i<e.byteLength-58;)R.readHeaderInfo(e,r),i+=r.headerInfo.blobSize,t++,r.ptr=i;return t}}}(),h=new ArrayBuffer(4),m=new Uint8Array(h),k=(new Uint32Array(h)[0]=1)===m[0],m={decode:function(e,t){if(!k)throw"Big endian system is not supported.";var i,r,a=(t=t||{}).inputOffset||0,n=new Uint8Array(e,a,10),n=String.fromCharCode.apply(null,n);if("CntZImage"===n.trim())i=w,r=1;else{if("Lerc2"!==n.substring(0,5))throw"Unexpected file identifier string: "+n;i=x,r=2}for(var s,l,o,f,u,d,c=0,h=e.byteLength-10,m=[],g={width:0,height:0,pixels:[],pixelType:t.pixelType,mask:null,statistics:[]};a<h;){var p=i.decode(e,{inputOffset:a,encodedMaskData:s,maskData:o,returnMask:0===c,returnEncodedMask:0===c,returnFileInfo:!0,pixelType:t.pixelType||null,noDataValue:t.noDataValue||null}),a=p.fileInfo.eofOffset;0===c&&(s=p.encodedMaskData,o=p.maskData,g.width=p.width,g.height=p.height,g.dimCount=p.dimCount||1,g.pixelType=p.pixelType||p.fileInfo.pixelType,g.mask=p.maskData),1<r&&p.fileInfo.mask&&0<p.fileInfo.mask.numBytes&&m.push(p.maskData),c++,g.pixels.push(p.pixelData),g.statistics.push({minValue:p.minValue,maxValue:p.maxValue,noDataValue:p.noDataValue,dimStats:p.dimStats})}if(1<r&&1<m.length){for(d=g.width*g.height,g.bandMasks=m,(o=new Uint8Array(d)).set(m[0]),f=1;f<m.length;f++)for(l=m[f],u=0;u<d;u++)o[u]=o[u]&l[u];g.maskData=o}return g}},g.Lerc=m;var p=g.Lerc;return e(function(e,t){if(e.encoding===l.LERC){var i;try{i=p.decode(e.heightmap)}catch(e){throw new n.RuntimeError(e)}if(i.statistics[0].minValue===Number.MAX_VALUE)throw new n.RuntimeError("Invalid tile data");e.heightmap=i.pixels[0],e.width=i.width,e.height=i.height}e.ellipsoid=Se.Ellipsoid.clone(e.ellipsoid),e.rectangle=Se.Rectangle.clone(e.rectangle);var r=ze.computeVertices(e),a=r.vertices;return t.push(a.buffer),{vertices:a.buffer,numberOfAttributes:r.encoding.getStride(),minimumHeight:r.minimumHeight,maximumHeight:r.maximumHeight,gridWidth:e.width,gridHeight:e.height,boundingSphere3D:r.boundingSphere3D,orientedBoundingBox:r.orientedBoundingBox,occludeePointInScaledSpace:r.occludeePointInScaledSpace,encoding:r.encoding,westIndicesSouthToNorth:r.westIndicesSouthToNorth,southIndicesEastToWest:r.southIndicesEastToWest,eastIndicesNorthToSouth:r.eastIndicesNorthToSouth,northIndicesWestToEast:r.northIndicesWestToEast}})});
//# sourceMappingURL=createVerticesFromHeightmap.js.map
