define(["./AttributeCompression-69c5b20c","./EllipsoidTangentPlane-8e486e83","./Transforms-f1816abc","./Cartesian2-716c2715","./when-208fe5b0","./TerrainEncoding-54905cbb","./IndexDatatype-d9b71b2b","./Math-3ba16bed","./OrientedBoundingBox-45cb4e24","./Check-d18af7c4","./WebMercatorProjection-3b6236c8","./createTaskProcessorWorker","./IntersectionTests-680c4e46","./Plane-f5dfabcd","./RuntimeError-7f634f5d","./ComponentDatatype-549ec0d3","./WebGLConstants-76bb35d1"],function(ie,oe,ae,se,de,he,ce,ue,le,l,Ie,e,t,r,n,i,o){"use strict";function me(){l.DeveloperError.throwInstantiationError()}Object.defineProperties(me.prototype,{errorEvent:{get:l.DeveloperError.throwInstantiationError},credit:{get:l.DeveloperError.throwInstantiationError},tilingScheme:{get:l.DeveloperError.throwInstantiationError},ready:{get:l.DeveloperError.throwInstantiationError},readyPromise:{get:l.DeveloperError.throwInstantiationError},hasWaterMask:{get:l.DeveloperError.throwInstantiationError},hasVertexNormals:{get:l.DeveloperError.throwInstantiationError},availability:{get:l.DeveloperError.throwInstantiationError}});var a=[];me.getRegularGridIndices=function(e,t){if(e*t>=ue.CesiumMath.FOUR_GIGABYTES)throw new l.DeveloperError("The total number of vertices (width * height) must be less than 4,294,967,296.");var r=a[e];de.defined(r)||(a[e]=r=[]);var n=r[t];return de.defined(n)||g(e,t,n=e*t<ue.CesiumMath.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6):r[t]=new Uint32Array((e-1)*(t-1)*6),0),n};var d=[];me.getRegularGridIndicesAndEdgeIndices=function(e,t){if(e*t>=ue.CesiumMath.FOUR_GIGABYTES)throw new l.DeveloperError("The total number of vertices (width * height) must be less than 4,294,967,296.");var r=d[e];de.defined(r)||(d[e]=r=[]);var n,i,o,a,s=r[t];return de.defined(s)||(n=me.getRegularGridIndices(e,t),i=(a=m(e,t)).westIndicesSouthToNorth,o=a.southIndicesEastToWest,e=a.eastIndicesNorthToSouth,a=a.northIndicesWestToEast,s=r[t]={indices:n,westIndicesSouthToNorth:i,southIndicesEastToWest:o,eastIndicesNorthToSouth:e,northIndicesWestToEast:a}),s};var I=[];function m(e,t){for(var r=new Array(t),n=new Array(e),i=new Array(t),o=new Array(e),a=0;a<e;++a)n[o[a]=a]=e*t-1-a;for(a=0;a<t;++a)i[a]=(a+1)*e-1,r[a]=(t-a-1)*e;return{westIndicesSouthToNorth:r,southIndicesEastToWest:n,eastIndicesNorthToSouth:i,northIndicesWestToEast:o}}function g(e,t,r,n){for(var i=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=i+e,d=s+1,h=i+1;r[n++]=i,r[n++]=s,r[n++]=h,r[n++]=h,r[n++]=s,r[n++]=d,++i}++i}}function s(e,t,r,n){for(var i=e[0],o=e.length,a=1;a<o;++a){var s=e[a];r[n++]=i,r[n++]=s,r[n++]=t,r[n++]=t,r[n++]=s,r[n++]=t+1,i=s,++t}return n}me.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){if(e*t>=ue.CesiumMath.FOUR_GIGABYTES)throw new l.DeveloperError("The total number of vertices (width * height) must be less than 4,294,967,296.");var r=I[e];de.defined(r)||(I[e]=r=[]);var n,i,o,a,s,d,h,c,u=r[t];return de.defined(u)||(o=(n=e*t)+(d=2*e+2*t),c=(i=(e-1)*(t-1)*6)+6*Math.max(0,d-4),a=(h=m(e,t)).westIndicesSouthToNorth,s=h.southIndicesEastToWest,d=h.eastIndicesNorthToSouth,h=h.northIndicesWestToEast,g(e,t,c=ce.IndexDatatype.createTypedArray(o,c),0),me.addSkirtIndices(a,s,d,h,n,c,i),u=r[t]={indices:c,westIndicesSouthToNorth:a,southIndicesEastToWest:s,eastIndicesNorthToSouth:d,northIndicesWestToEast:h,indexCountWithoutSkirts:i}),u},me.addSkirtIndices=function(e,t,r,n,i,o,a){a=s(e,i,o,a),a=s(t,i+=e.length,o,a),a=s(r,i+=t.length,o,a),s(n,i+=r.length,o,a)},me.heightmapTerrainQuality=.25,me.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*me.heightmapTerrainQuality/(t*r)},me.prototype.requestTileGeometry=l.DeveloperError.throwInstantiationError,me.prototype.getLevelMaximumGeometricError=l.DeveloperError.throwInstantiationError,me.prototype.getTileDataAvailable=l.DeveloperError.throwInstantiationError,me.prototype.loadTileDataAvailability=l.DeveloperError.throwInstantiationError;var ge=32767,Te=new se.Cartesian3,pe=new se.Cartesian3,Ee=new se.Cartesian3,fe=new se.Cartographic,ye=new se.Cartesian2,ve=new se.Cartesian3,we=new ae.Matrix4,be=new ae.Matrix4;function Ne(e,t,r,n,i,o,a,s,d){var h=Number.POSITIVE_INFINITY,c=i.north,u=i.south,l=i.east,I=i.west;l<I&&(l+=ue.CesiumMath.TWO_PI);for(var m=e.length,g=0;g<m;++g){var T=e[g],p=r[T],T=n[T];fe.longitude=ue.CesiumMath.lerp(I,l,T.x),fe.latitude=ue.CesiumMath.lerp(u,c,T.y),fe.height=p-t;p=o.cartographicToCartesian(fe,Te);ae.Matrix4.multiplyByPoint(a,p,p),se.Cartesian3.minimumByComponent(p,s,s),se.Cartesian3.maximumByComponent(p,d,d),h=Math.min(h,fe.height)}return h}function Me(e,t,r,n,i,o,a,s,d,h,c,u,l,I,m){var g=de.defined(a),T=d.north,p=d.south,E=d.east,f=d.west;E<f&&(E+=ue.CesiumMath.TWO_PI);for(var y=r.length,v=0;v<y;++v){var w=r[v],b=i[w],N=o[w];fe.longitude=ue.CesiumMath.lerp(f,E,N.x)+I,fe.latitude=ue.CesiumMath.lerp(p,T,N.y)+m,fe.height=b-h;var M,x,C=s.cartographicToCartesian(fe,Te);g&&(M=2*w,ye.x=a[M],ye.y=a[1+M],1!==c&&(b=ie.AttributeCompression.octDecode(ye.x,ye.y,ve),w=ae.Transforms.eastNorthUpToFixedFrame(Te,s,be),M=ae.Matrix4.inverseTransformation(w,we),ae.Matrix4.multiplyByPointAsVector(M,b,b),b.z*=c,se.Cartesian3.normalize(b,b),ae.Matrix4.multiplyByPointAsVector(w,b,b),se.Cartesian3.normalize(b,b),ie.AttributeCompression.octEncode(b,ye))),n.hasWebMercatorT&&(x=(Ie.WebMercatorProjection.geodeticLatitudeToMercatorAngle(fe.latitude)-u)*l),t=n.encode(e,t,C,N,fe.height,ye,x)}}function xe(e,t){var r;return"function"==typeof e.slice&&"function"!=typeof(r=e.slice()).sort&&(r=void 0),(r=!de.defined(r)?Array.prototype.slice.call(e):r).sort(t),r}return e(function(e,t){var r,n,i=(ne=e.quantizedVertices).length/3,o=e.octEncodedNormals,a=e.westIndices.length+e.eastIndices.length+e.southIndices.length+e.northIndices.length,s=e.includeWebMercatorT,d=se.Rectangle.clone(e.rectangle),h=d.west,c=d.south,u=d.east,l=d.north,I=se.Ellipsoid.clone(e.ellipsoid),m=e.exaggeration,g=e.minimumHeight*m,T=e.maximumHeight*m,p=e.relativeToCenter,E=ae.Transforms.eastNorthUpToFixedFrame(p,I),f=ae.Matrix4.inverseTransformation(E,new ae.Matrix4);s&&(r=Ie.WebMercatorProjection.geodeticLatitudeToMercatorAngle(c),n=1/(Ie.WebMercatorProjection.geodeticLatitudeToMercatorAngle(l)-r));var y=ne.subarray(0,i),v=ne.subarray(i,2*i),w=ne.subarray(2*i,3*i),b=de.defined(o),N=new Array(i),M=new Array(i),x=new Array(i),C=s?new Array(i):[],S=pe;S.x=Number.POSITIVE_INFINITY,S.y=Number.POSITIVE_INFINITY,S.z=Number.POSITIVE_INFINITY;var A=Ee;A.x=Number.NEGATIVE_INFINITY,A.y=Number.NEGATIVE_INFINITY,A.z=Number.NEGATIVE_INFINITY;for(var P=Number.POSITIVE_INFINITY,W=Number.NEGATIVE_INFINITY,D=Number.POSITIVE_INFINITY,B=Number.NEGATIVE_INFINITY,F=0;F<i;++F){var G=y[F],k=v[F],_=G/ge,O=k/ge,G=ue.CesiumMath.lerp(g,T,w[F]/ge);fe.longitude=ue.CesiumMath.lerp(h,u,_),fe.latitude=ue.CesiumMath.lerp(c,l,O),fe.height=G;P=Math.min(fe.longitude,P),W=Math.max(fe.longitude,W),D=Math.min(fe.latitude,D),B=Math.max(fe.latitude,B),k=I.cartographicToCartesian(fe);N[F]=new se.Cartesian2(_,O),M[F]=G,x[F]=k,s&&(C[F]=(Ie.WebMercatorProjection.geodeticLatitudeToMercatorAngle(fe.latitude)-r)*n),ae.Matrix4.multiplyByPoint(f,k,Te),se.Cartesian3.minimumByComponent(Te,S,S),se.Cartesian3.maximumByComponent(Te,A,A)}var V,Y,H,R=xe(e.westIndices,function(e,t){return N[e].y-N[t].y}),z=xe(e.eastIndices,function(e,t){return N[t].y-N[e].y}),U=xe(e.southIndices,function(e,t){return N[t].x-N[e].x}),L=xe(e.northIndices,function(e,t){return N[e].x-N[t].x});1!==m&&(Y=ae.BoundingSphere.fromPoints(x),V=le.OrientedBoundingBox.fromRectangle(d,g,T,I)),(1!==m||g<0)&&(H=new he.EllipsoidalOccluder(I).computeHorizonCullingPointPossiblyUnderEllipsoid(p,x,g));var j=g,j=Math.min(j,Ne(e.westIndices,e.westSkirtHeight,M,N,d,I,f,S,A));j=Math.min(j,Ne(e.southIndices,e.southSkirtHeight,M,N,d,I,f,S,A)),j=Math.min(j,Ne(e.eastIndices,e.eastSkirtHeight,M,N,d,I,f,S,A)),j=Math.min(j,Ne(e.northIndices,e.northSkirtHeight,M,N,d,I,f,S,A));for(var q,Q,K,X=new oe.AxisAlignedBoundingBox(S,A,p),Z=new he.TerrainEncoding(X,j,T,E,b,s),J=Z.getStride(),$=new Float32Array(i*J+a*J),ee=0,te=0;te<i;++te)b&&(K=2*te,ye.x=o[K],ye.y=o[1+K],1!==m&&(q=ie.AttributeCompression.octDecode(ye.x,ye.y,ve),Q=ae.Transforms.eastNorthUpToFixedFrame(x[te],I,be),K=ae.Matrix4.inverseTransformation(Q,we),ae.Matrix4.multiplyByPointAsVector(K,q,q),q.z*=m,se.Cartesian3.normalize(q,q),ae.Matrix4.multiplyByPointAsVector(Q,q,q),se.Cartesian3.normalize(q,q),ie.AttributeCompression.octEncode(q,ye))),ee=Z.encode($,ee,x[te],N[te],M[te],ye,C[te]);var re=Math.max(0,2*(a-4)),ne=e.indices.length+3*re;return(X=ce.IndexDatatype.createTypedArray(i+a,ne)).set(e.indices,0),re=-(j=1e-4*(W-P)),a=j,j=-(ne=E=1e-4*(B-D)),Me($,E=i*J,R,Z,M,N,o,I,d,e.westSkirtHeight,m,r,n,re,0),Me($,E+=e.westIndices.length*J,U,Z,M,N,o,I,d,e.southSkirtHeight,m,r,n,0,j),Me($,E+=e.southIndices.length*J,z,Z,M,N,o,I,d,e.eastSkirtHeight,m,r,n,a,0),Me($,E+=e.eastIndices.length*J,L,Z,M,N,o,I,d,e.northSkirtHeight,m,r,n,0,ne),me.addSkirtIndices(R,U,z,L,i,X,e.indices.length),t.push($.buffer,X.buffer),{vertices:$.buffer,indices:X.buffer,westIndicesSouthToNorth:R,southIndicesEastToWest:U,eastIndicesNorthToSouth:z,northIndicesWestToEast:L,vertexStride:J,center:p,minimumHeight:g,maximumHeight:T,boundingSphere:Y,orientedBoundingBox:V,occludeePointInScaledSpace:H,encoding:Z,indexCountWithoutSkirts:e.indices.length}})});
//# sourceMappingURL=createVerticesFromQuantizedTerrainMesh.js.map
