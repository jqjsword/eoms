define(["./when-208fe5b0","./Cartesian2-716c2715","./GeometryOffsetAttribute-d63c288d","./Transforms-f1816abc","./Check-d18af7c4","./ComponentDatatype-549ec0d3","./GeometryAttribute-0ee94cf1","./GeometryAttributes-b0b294d8","./GeometryInstance-73b5b8d6","./GeometryPipeline-df743242","./IndexDatatype-d9b71b2b","./Math-3ba16bed","./PolygonPipeline-ac89187a","./RectangleGeometryLibrary-2356d7aa","./VertexFormat-24041ad5","./RuntimeError-7f634f5d","./WebGLConstants-76bb35d1","./AttributeCompression-69c5b20c","./EncodedCartesian3-7a9c1496","./IntersectionTests-680c4e46","./Plane-f5dfabcd","./EllipsoidRhumbLine-886cd793"],function(X,Q,W,N,m,J,Z,r,K,$,tt,et,at,k,rt,t,e,a,n,o,i,s){"use strict";var nt=new Q.Cartesian3,ot=new Q.Cartesian3,it=new Q.Cartesian3,st=new Q.Cartesian3,p=new Q.Rectangle,S=new Q.Cartesian2,g=new N.BoundingSphere,y=new N.BoundingSphere;function lt(t,e){var a=new Z.Geometry({attributes:new r.GeometryAttributes,primitiveType:Z.PrimitiveType.TRIANGLES});return a.attributes.position=new Z.GeometryAttribute({componentDatatype:J.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:e.positions}),t.normal&&(a.attributes.normal=new Z.GeometryAttribute({componentDatatype:J.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.normals})),t.tangent&&(a.attributes.tangent=new Z.GeometryAttribute({componentDatatype:J.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.tangents})),t.bitangent&&(a.attributes.bitangent=new Z.GeometryAttribute({componentDatatype:J.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.bitangents})),a}var ut=new Q.Cartesian3,ct=new Q.Cartesian3;function dt(t,e){var a=t._vertexFormat,r=t._ellipsoid,n=e.height,o=e.width,i=e.northCap,s=e.southCap,l=0,u=n,c=n,t=0;i&&(--c,t+=l=1),s&&(--u,--c,t+=1),t+=o*c;for(var d=a.position?new Float64Array(3*t):void 0,m=a.st?new Float32Array(2*t):void 0,p=0,g=0,y=nt,f=S,h=Number.MAX_VALUE,b=Number.MAX_VALUE,v=-Number.MAX_VALUE,_=-Number.MAX_VALUE,A=l;A<u;++A)for(var w=0;w<o;++w)k.RectangleGeometryLibrary.computePosition(e,r,a.st,A,w,y,f),d[p++]=y.x,d[p++]=y.y,d[p++]=y.z,a.st&&(m[g++]=f.x,m[g++]=f.y,h=Math.min(h,f.x),b=Math.min(b,f.y),v=Math.max(v,f.x),_=Math.max(_,f.y));if(i&&(k.RectangleGeometryLibrary.computePosition(e,r,a.st,0,0,y,f),d[p++]=y.x,d[p++]=y.y,d[p++]=y.z,a.st&&(m[g++]=f.x,m[g++]=f.y,h=f.x,b=f.y,v=f.x,_=f.y)),s&&(k.RectangleGeometryLibrary.computePosition(e,r,a.st,n-1,0,y,f),d[p++]=y.x,d[p++]=y.y,d[p]=y.z,a.st&&(m[g++]=f.x,m[g]=f.y,h=Math.min(h,f.x),b=Math.min(b,f.y),v=Math.max(v,f.x),_=Math.max(_,f.y))),a.st&&(h<0||b<0||1<v||1<_))for(var x=0;x<m.length;x+=2)m[x]=(m[x]-h)/(v-h),m[x+1]=(m[x+1]-b)/(_-b);l=function(t,e,a,r){var n=t.length,o=e.normal?new Float32Array(n):void 0,i=e.tangent?new Float32Array(n):void 0,s=e.bitangent?new Float32Array(n):void 0,l=0,u=st,c=it,d=ot;if(e.normal||e.tangent||e.bitangent)for(var m=0;m<n;m+=3){var p=Q.Cartesian3.fromArray(t,m,nt),g=l+1,y=l+2,d=a.geodeticSurfaceNormal(p,d);(e.tangent||e.bitangent)&&(Q.Cartesian3.cross(Q.Cartesian3.UNIT_Z,d,c),N.Matrix3.multiplyByVector(r,c,c),Q.Cartesian3.normalize(c,c),e.bitangent&&Q.Cartesian3.normalize(Q.Cartesian3.cross(d,c,u),u)),e.normal&&(o[l]=d.x,o[g]=d.y,o[y]=d.z),e.tangent&&(i[l]=c.x,i[g]=c.y,i[y]=c.z),e.bitangent&&(s[l]=u.x,s[g]=u.y,s[y]=u.z),l+=3}return lt(e,{positions:t,normals:o,tangents:i,bitangents:s})}(d,a,r,e.tangentRotationMatrix),n=6*(o-1)*(c-1);i&&(n+=3*(o-1)),s&&(n+=3*(o-1));for(var C=tt.IndexDatatype.createTypedArray(t,n),R=0,E=0,F=0;F<c-1;++F){for(var G=0;G<o-1;++G){var P=R+o,V=P+1,D=R+1;C[E++]=R,C[E++]=P,C[E++]=D,C[E++]=D,C[E++]=P,C[E++]=V,++R}++R}if(i||s){var L,M,O=t-1,T=t-1;if(i&&s&&(O=t-2),R=0,i)for(F=0;F<o-1;F++)M=(L=R)+1,C[E++]=O,C[E++]=L,C[E++]=M,++R;if(s)for(R=(c-1)*o,F=0;F<o-1;F++)M=(L=R)+1,C[E++]=L,C[E++]=T,C[E++]=M,++R}return l.indices=C,a.st&&(l.attributes.st=new Z.GeometryAttribute({componentDatatype:J.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:m})),l}function mt(t,e,a,r,n){return t[e++]=r[a],t[e++]=r[a+1],t[e++]=r[a+2],t[e++]=n[a],t[e++]=n[a+1],t[e]=n[a+2],t}function pt(t,e,a,r){return t[e++]=r[a],t[e++]=r[a+1],t[e++]=r[a],t[e]=r[a+1],t}var gt=new rt.VertexFormat;function f(t,e){var a=t._shadowVolume,r=t._offsetAttribute,n=t._vertexFormat,o=t._extrudedHeight,i=t._surfaceHeight,s=t._ellipsoid,l=e.height,u=e.width;a&&((b=rt.VertexFormat.clone(n,gt)).normal=!0,t._vertexFormat=b);var c=dt(t,e);a&&(t._vertexFormat=n);var d=at.PolygonPipeline.scaleToGeodeticHeight(c.attributes.position.values,i,s,!1),m=2*(z=(d=new Float64Array(d)).length),p=new Float64Array(m);p.set(d);var g=at.PolygonPipeline.scaleToGeodeticHeight(c.attributes.position.values,o,s);p.set(g,z),c.attributes.position.values=p;var y,f,h,b=n.normal?new Float32Array(m):void 0,t=n.tangent?new Float32Array(m):void 0,i=n.bitangent?new Float32Array(m):void 0,o=n.st?new Float32Array(m/3*2):void 0;if(n.normal){for(f=c.attributes.normal.values,b.set(f),_=0;_<z;_++)f[_]=-f[_];b.set(f,z),c.attributes.normal.values=b}if(a){f=c.attributes.normal.values,n.normal||(c.attributes.normal=void 0);for(var v=new Float32Array(m),_=0;_<z;_++)f[_]=-f[_];v.set(f,z),c.attributes.extrudeDirection=new Z.GeometryAttribute({componentDatatype:J.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:v})}p=X.defined(r);if(p&&(b=z/3*2,v=new Uint8Array(b),v=r===W.GeometryOffsetAttribute.TOP?W.arrayFill(v,1,0,b/2):(h=r===W.GeometryOffsetAttribute.NONE?0:1,W.arrayFill(v,h)),c.attributes.applyOffset=new Z.GeometryAttribute({componentDatatype:J.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:v})),n.tangent){var A=c.attributes.tangent.values;for(t.set(A),_=0;_<z;_++)A[_]=-A[_];t.set(A,z),c.attributes.tangent.values=t}n.bitangent&&(E=c.attributes.bitangent.values,i.set(E),i.set(E,z),c.attributes.bitangent.values=i),n.st&&(y=c.attributes.st.values,o.set(y),o.set(y,z/3*2),c.attributes.st.values=o);var w=c.indices,x=w.length,C=z/3,R=tt.IndexDatatype.createTypedArray(m/3,2*x);for(R.set(w),_=0;_<x;_+=3)R[_+x]=w[_+2]+C,R[_+1+x]=w[_+1]+C,R[_+2+x]=w[_]+C;c.indices=R;var t=e.northCap,E=e.southCap,i=l,o=2,m=0,e=4,l=4;t&&(--o,--i,m+=1,e-=2,--l),E&&(--o,--i,m+=1,e-=2,--l);var l=2*((m+=o*u+2*i-e)+l),F=new Float64Array(3*l),G=a?new Float32Array(3*l):void 0,P=p?new Uint8Array(l):void 0,V=n.st?new Float32Array(2*l):void 0,D=r===W.GeometryOffsetAttribute.TOP;p&&!D&&(h=r===W.GeometryOffsetAttribute.ALL?1:0,P=W.arrayFill(P,h));var L=0,M=0,O=0,T=0,N=u*i;for(_=0;_<N;_+=u)F=mt(F,L,S=3*_,d,g),L+=6,n.st&&(V=pt(V,M,2*_,y),M+=4),a&&(O+=3,G[O++]=f[S],G[O++]=f[S+1],G[O++]=f[S+2]),D&&(P[T++]=1,T+=1);if(E){var k=t?1+N:N,S=3*k;for(_=0;_<2;_++)F=mt(F,L,S,d,g),L+=6,n.st&&(V=pt(V,M,2*k,y),M+=4),a&&(O+=3,G[O++]=f[S],G[O++]=f[S+1],G[O++]=f[S+2]),D&&(P[T++]=1,T+=1)}else for(_=N-u;_<N;_++)F=mt(F,L,S=3*_,d,g),L+=6,n.st&&(V=pt(V,M,2*_,y),M+=4),a&&(O+=3,G[O++]=f[S],G[O++]=f[S+1],G[O++]=f[S+2]),D&&(P[T++]=1,T+=1);for(_=N-1;0<_;_-=u)F=mt(F,L,S=3*_,d,g),L+=6,n.st&&(V=pt(V,M,2*_,y),M+=4),a&&(O+=3,G[O++]=f[S],G[O++]=f[S+1],G[O++]=f[S+2]),D&&(P[T++]=1,T+=1);if(t){var I=N;for(S=3*I,_=0;_<2;_++)F=mt(F,L,S,d,g),L+=6,n.st&&(V=pt(V,M,2*I,y),M+=4),a&&(O+=3,G[O++]=f[S],G[O++]=f[S+1],G[O++]=f[S+2]),D&&(P[T++]=1,T+=1)}else for(_=u-1;0<=_;_--)F=mt(F,L,S=3*_,d,g),L+=6,n.st&&(V=pt(V,M,2*_,y),M+=4),a&&(O+=3,G[O++]=f[S],G[O++]=f[S+1],G[O++]=f[S+2]),D&&(P[T++]=1,T+=1);s=function(t,e,a){var r=t.length,n=e.normal?new Float32Array(r):void 0,o=e.tangent?new Float32Array(r):void 0,i=e.bitangent?new Float32Array(r):void 0,s=0,l=0,u=0,c=!0,d=st,m=it,p=ot;if(e.normal||e.tangent||e.bitangent)for(var g=0;g<r;g+=6){var y,f=Q.Cartesian3.fromArray(t,g,nt),h=Q.Cartesian3.fromArray(t,(g+6)%r,ut);c&&(y=Q.Cartesian3.fromArray(t,(g+3)%r,ct),Q.Cartesian3.subtract(h,f,h),Q.Cartesian3.subtract(y,f,y),p=Q.Cartesian3.normalize(Q.Cartesian3.cross(y,h,p),p),c=!1),Q.Cartesian3.equalsEpsilon(h,f,et.CesiumMath.EPSILON10)&&(c=!0),(e.tangent||e.bitangent)&&(d=a.geodeticSurfaceNormal(f,d),e.tangent&&(m=Q.Cartesian3.normalize(Q.Cartesian3.cross(d,p,m),m))),e.normal&&(n[s++]=p.x,n[s++]=p.y,n[s++]=p.z,n[s++]=p.x,n[s++]=p.y,n[s++]=p.z),e.tangent&&(o[l++]=m.x,o[l++]=m.y,o[l++]=m.z,o[l++]=m.x,o[l++]=m.y,o[l++]=m.z),e.bitangent&&(i[u++]=d.x,i[u++]=d.y,i[u++]=d.z,i[u++]=d.x,i[u++]=d.y,i[u++]=d.z)}return lt(e,{positions:t,normals:n,tangents:o,bitangents:i})}(F,n,s);n.st&&(s.attributes.st=new Z.GeometryAttribute({componentDatatype:J.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:V})),a&&(s.attributes.extrudeDirection=new Z.GeometryAttribute({componentDatatype:J.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:G})),p&&(s.attributes.applyOffset=new Z.GeometryAttribute({componentDatatype:J.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:P}));var H=tt.IndexDatatype.createTypedArray(l,6*m),z=F.length/3,B=0;for(_=0;_<z-1;_+=2){var U,q=((U=_)+2)%z,Y=Q.Cartesian3.fromArray(F,3*U,ut),j=Q.Cartesian3.fromArray(F,3*q,ct);Q.Cartesian3.equalsEpsilon(Y,j,et.CesiumMath.EPSILON10)||(j=(2+(Y=(U+1)%z))%z,H[B++]=U,H[B++]=Y,H[B++]=q,H[B++]=q,H[B++]=Y,H[B++]=j)}return s.indices=H,(s=$.GeometryPipeline.combineInstances([new K.GeometryInstance({geometry:c}),new K.GeometryInstance({geometry:s})]))[0]}var l=[new Q.Cartesian3,new Q.Cartesian3,new Q.Cartesian3,new Q.Cartesian3],h=new Q.Cartographic,b=new Q.Cartographic;function c(t,e,a,r,n){if(0===a)return Q.Rectangle.clone(t,n);var o=k.RectangleGeometryLibrary.computeOptions(t,e,a,0,p,h),t=o.height,e=o.width,a=l;return k.RectangleGeometryLibrary.computePosition(o,r,!1,0,0,a[0]),k.RectangleGeometryLibrary.computePosition(o,r,!1,0,e-1,a[1]),k.RectangleGeometryLibrary.computePosition(o,r,!1,t-1,0,a[2]),k.RectangleGeometryLibrary.computePosition(o,r,!1,t-1,e-1,a[3]),Q.Rectangle.fromCartesianArray(a,r,n)}function v(t){var e=(t=X.defaultValue(t,X.defaultValue.EMPTY_OBJECT)).rectangle;if(m.Check.typeOf.object("rectangle",e),Q.Rectangle.validate(e),e.north<e.south)throw new m.DeveloperError("options.rectangle.north must be greater than or equal to options.rectangle.south");var a=X.defaultValue(t.height,0),r=X.defaultValue(t.extrudedHeight,a);this._rectangle=Q.Rectangle.clone(e),this._granularity=X.defaultValue(t.granularity,et.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=Q.Ellipsoid.clone(X.defaultValue(t.ellipsoid,Q.Ellipsoid.WGS84)),this._surfaceHeight=Math.max(a,r),this._rotation=X.defaultValue(t.rotation,0),this._stRotation=X.defaultValue(t.stRotation,0),this._vertexFormat=rt.VertexFormat.clone(X.defaultValue(t.vertexFormat,rt.VertexFormat.DEFAULT)),this._extrudedHeight=Math.min(a,r),this._shadowVolume=X.defaultValue(t.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=t.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}v.packedLength=Q.Rectangle.packedLength+Q.Ellipsoid.packedLength+rt.VertexFormat.packedLength+7,v.pack=function(t,e,a){return m.Check.typeOf.object("value",t),m.Check.defined("array",e),a=X.defaultValue(a,0),Q.Rectangle.pack(t._rectangle,e,a),a+=Q.Rectangle.packedLength,Q.Ellipsoid.pack(t._ellipsoid,e,a),a+=Q.Ellipsoid.packedLength,rt.VertexFormat.pack(t._vertexFormat,e,a),a+=rt.VertexFormat.packedLength,e[a++]=t._granularity,e[a++]=t._surfaceHeight,e[a++]=t._rotation,e[a++]=t._stRotation,e[a++]=t._extrudedHeight,e[a++]=t._shadowVolume?1:0,e[a]=X.defaultValue(t._offsetAttribute,-1),e};var _=new Q.Rectangle,A=Q.Ellipsoid.clone(Q.Ellipsoid.UNIT_SPHERE),w={rectangle:_,ellipsoid:A,vertexFormat:gt,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};v.unpack=function(t,e,a){m.Check.defined("array",t),e=X.defaultValue(e,0);var r=Q.Rectangle.unpack(t,e,_);e+=Q.Rectangle.packedLength;var n=Q.Ellipsoid.unpack(t,e,A);e+=Q.Ellipsoid.packedLength;var o=rt.VertexFormat.unpack(t,e,gt);e+=rt.VertexFormat.packedLength;var i=t[e++],s=t[e++],l=t[e++],u=t[e++],c=t[e++],d=1===t[e++],e=t[e];return X.defined(a)?(a._rectangle=Q.Rectangle.clone(r,a._rectangle),a._ellipsoid=Q.Ellipsoid.clone(n,a._ellipsoid),a._vertexFormat=rt.VertexFormat.clone(o,a._vertexFormat),a._granularity=i,a._surfaceHeight=s,a._rotation=l,a._stRotation=u,a._extrudedHeight=c,a._shadowVolume=d,a._offsetAttribute=-1===e?void 0:e,a):(w.granularity=i,w.height=s,w.rotation=l,w.stRotation=u,w.extrudedHeight=c,w.shadowVolume=d,w.offsetAttribute=-1===e?void 0:e,new v(w))},v.computeRectangle=function(t,e){var a=(t=X.defaultValue(t,X.defaultValue.EMPTY_OBJECT)).rectangle;if(m.Check.typeOf.object("rectangle",a),Q.Rectangle.validate(a),a.north<a.south)throw new m.DeveloperError("options.rectangle.north must be greater than or equal to options.rectangle.south");var r=X.defaultValue(t.granularity,et.CesiumMath.RADIANS_PER_DEGREE),n=X.defaultValue(t.ellipsoid,Q.Ellipsoid.WGS84);return c(a,r,X.defaultValue(t.rotation,0),n,e)};var x=new N.Matrix3,C=new N.Quaternion,R=new Q.Cartographic;v.createGeometry=function(t){if(!et.CesiumMath.equalsEpsilon(t._rectangle.north,t._rectangle.south,et.CesiumMath.EPSILON10)&&!et.CesiumMath.equalsEpsilon(t._rectangle.east,t._rectangle.west,et.CesiumMath.EPSILON10)){var e=t._rectangle,a=t._ellipsoid,r=t._rotation,n=t._stRotation,o=t._vertexFormat,i=k.RectangleGeometryLibrary.computeOptions(e,t._granularity,r,n,p,h,b),s=x;0!==n||0!==r?(c=Q.Rectangle.center(e,R),d=a.geodeticSurfaceNormalCartographic(c,ut),N.Quaternion.fromAxisAngle(d,-n,C),N.Matrix3.fromQuaternion(C,s)):N.Matrix3.clone(N.Matrix3.IDENTITY,s);var l,u,c=t._surfaceHeight,d=t._extrudedHeight,n=!et.CesiumMath.equalsEpsilon(c,d,0,et.CesiumMath.EPSILON2);return i.lonScalar=1/t._rectangle.width,i.latScalar=1/t._rectangle.height,i.tangentRotationMatrix=s,e=t._rectangle,c=n?(l=f(t,i),n=N.BoundingSphere.fromRectangle3D(e,a,c,y),u=N.BoundingSphere.fromRectangle3D(e,a,d,g),N.BoundingSphere.union(n,u)):((l=dt(t,i)).attributes.position.values=at.PolygonPipeline.scaleToGeodeticHeight(l.attributes.position.values,c,a,!1),X.defined(t._offsetAttribute)&&(u=l.attributes.position.values.length,i=new Uint8Array(u/3),u=t._offsetAttribute===W.GeometryOffsetAttribute.NONE?0:1,W.arrayFill(i,u),l.attributes.applyOffset=new Z.GeometryAttribute({componentDatatype:J.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:i})),N.BoundingSphere.fromRectangle3D(e,a,c)),o.position||delete l.attributes.position,new Z.Geometry({attributes:l.attributes,indices:l.indices,primitiveType:l.primitiveType,boundingSphere:c,offsetAttribute:t._offsetAttribute})}},v.createShadowVolume=function(t,e,a){var r=t._granularity,n=t._ellipsoid,e=e(r,n),a=a(r,n);return new v({rectangle:t._rectangle,rotation:t._rotation,ellipsoid:n,stRotation:t._stRotation,granularity:r,extrudedHeight:a,height:e,vertexFormat:rt.VertexFormat.POSITION_ONLY,shadowVolume:!0})};var d=new Q.Rectangle,E=[new Q.Cartesian2,new Q.Cartesian2,new Q.Cartesian2],F=new Z.Matrix2,G=new Q.Cartographic;return Object.defineProperties(v.prototype,{rectangle:{get:function(){return X.defined(this._rotatedRectangle)||(this._rotatedRectangle=c(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return X.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){if(0===t._stRotation)return[0,0,0,1,1,0];var e=Q.Rectangle.clone(t._rectangle,d),a=t._granularity,r=t._ellipsoid,e=c(e,a,t._rotation-t._stRotation,r,d),n=E;n[0].x=e.west,n[0].y=e.south,n[1].x=e.west,n[1].y=e.north,n[2].x=e.east,n[2].y=e.south;for(var o=t.rectangle,i=Z.Matrix2.fromRotation(t._stRotation,F),s=Q.Rectangle.center(o,G),l=0;l<3;++l){var u=n[l];u.x-=s.longitude,u.y-=s.latitude,Z.Matrix2.multiplyByVector(i,u,u),u.x+=s.longitude,u.y+=s.latitude,u.x=(u.x-o.west)/o.width,u.y=(u.y-o.south)/o.height}return a=n[0],r=n[1],e=n[2],t=new Array(6),Q.Cartesian2.pack(a,t),Q.Cartesian2.pack(r,t,2),Q.Cartesian2.pack(e,t,4),t}(this)),this._textureCoordinateRotationPoints}}}),function(t,e){return(t=X.defined(e)?v.unpack(t,e):t)._ellipsoid=Q.Ellipsoid.clone(t._ellipsoid),t._rectangle=Q.Rectangle.clone(t._rectangle),v.createGeometry(t)}});
//# sourceMappingURL=createRectangleGeometry.js.map
