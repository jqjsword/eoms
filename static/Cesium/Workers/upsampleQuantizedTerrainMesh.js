define(["./AttributeCompression-69c5b20c","./Transforms-f1816abc","./Cartesian2-716c2715","./when-208fe5b0","./TerrainEncoding-54905cbb","./IndexDatatype-d9b71b2b","./Check-d18af7c4","./Math-3ba16bed","./OrientedBoundingBox-45cb4e24","./createTaskProcessorWorker","./RuntimeError-7f634f5d","./ComponentDatatype-549ec0d3","./WebGLConstants-76bb35d1","./EllipsoidTangentPlane-8e486e83","./IntersectionTests-680c4e46","./Plane-f5dfabcd"],function(n,oe,de,g,pe,ae,m,fe,le,e,i,r,t,s,h,u){"use strict";var ce={clipTriangleAtAxisAlignedThreshold:function(e,i,r,t,n,s){if(!g.defined(e))throw new m.DeveloperError("threshold is required.");if(!g.defined(i))throw new m.DeveloperError("keepAbove is required.");if(!g.defined(r))throw new m.DeveloperError("u0 is required.");if(!g.defined(t))throw new m.DeveloperError("u1 is required.");if(!g.defined(n))throw new m.DeveloperError("u2 is required.");var h,u;g.defined(s)?s.length=0:s=[];var o,d,p,a,f,l,c=i?(h=r<e,u=t<e,n<e):(h=e<r,u=e<t,e<n),i=h+u+c;return 1===i?h?(o=(e-r)/(t-r),d=(e-r)/(n-r),s.push(1),s.push(2),1!==d&&(s.push(-1),s.push(0),s.push(2),s.push(d)),1!==o&&(s.push(-1),s.push(0),s.push(1),s.push(o))):u?(p=(e-t)/(n-t),a=(e-t)/(r-t),s.push(2),s.push(0),1!==a&&(s.push(-1),s.push(1),s.push(0),s.push(a)),1!==p&&(s.push(-1),s.push(1),s.push(2),s.push(p))):c&&(f=(e-n)/(r-n),l=(e-n)/(t-n),s.push(0),s.push(1),1!==l&&(s.push(-1),s.push(2),s.push(1),s.push(l)),1!==f&&(s.push(-1),s.push(2),s.push(0),s.push(f))):2===i?h||r===e?u||t===e?c||n===e||(d=(e-r)/(n-r),p=(e-t)/(n-t),s.push(2),s.push(-1),s.push(0),s.push(2),s.push(d),s.push(-1),s.push(1),s.push(2),s.push(p)):(l=(e-n)/(t-n),o=(e-r)/(t-r),s.push(1),s.push(-1),s.push(2),s.push(1),s.push(l),s.push(-1),s.push(0),s.push(1),s.push(o)):(a=(e-t)/(r-t),f=(e-n)/(r-n),s.push(0),s.push(-1),s.push(1),s.push(0),s.push(a),s.push(-1),s.push(2),s.push(0),s.push(f)):3!==i&&(s.push(0),s.push(1),s.push(2)),s},computeBarycentricCoordinates:function(e,i,r,t,n,s,h,u,o){if(!g.defined(e))throw new m.DeveloperError("x is required.");if(!g.defined(i))throw new m.DeveloperError("y is required.");if(!g.defined(r))throw new m.DeveloperError("x1 is required.");if(!g.defined(t))throw new m.DeveloperError("y1 is required.");if(!g.defined(n))throw new m.DeveloperError("x2 is required.");if(!g.defined(s))throw new m.DeveloperError("y2 is required.");if(!g.defined(h))throw new m.DeveloperError("x3 is required.");if(!g.defined(u))throw new m.DeveloperError("y3 is required.");var d=r-h,r=h-n,n=s-u,s=t-u,t=1/(n*d+r*s),u=i-u,h=e-h,r=(n*h+r*u)*t,u=(-s*h+d*u)*t,t=1-r-u;return g.defined(o)?(o.x=r,o.y=u,o.z=t,o):new de.Cartesian3(r,u,t)},computeLineSegmentLineSegmentIntersection:function(e,i,r,t,n,s,h,u,o){m.Check.typeOf.number("x00",e),m.Check.typeOf.number("y00",i),m.Check.typeOf.number("x01",r),m.Check.typeOf.number("y01",t),m.Check.typeOf.number("x10",n),m.Check.typeOf.number("y10",s),m.Check.typeOf.number("x11",h),m.Check.typeOf.number("y11",u);var d=(h-n)*(i-s)-(u-s)*(e-n),p=(r-e)*(i-s)-(t-i)*(e-n),n=(u-s)*(r-e)-(h-n)*(t-i);if(0!=n){d=d/n,n=p/n;return 0<=d&&d<=1&&0<=n&&n<=1?((o=!g.defined(o)?new de.Cartesian2:o).x=e+d*(r-e),o.y=i+d*(t-i),o):void 0}}},ge=32767,me=16383,we=[],xe=[],ve=[],Ce=new de.Cartographic,ye=new de.Cartesian3,be=[],Be=[],Ie=[],Ae=[],Ee=[],De=new de.Cartesian3,Te=new oe.BoundingSphere,Oe=new le.OrientedBoundingBox,ze=new de.Cartesian2,ke=new de.Cartesian3;function Me(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}Me.prototype.clone=function(e){return(e=!g.defined(e)?new Me:e).uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},Me.prototype.initializeIndexed=function(e,i,r,t,n){this.uBuffer=e,this.vBuffer=i,this.heightBuffer=r,this.normalBuffer=t,this.index=n,this.first=void 0,this.second=void 0,this.ratio=void 0},Me.prototype.initializeFromClipResult=function(e,i,r){var t=i+1;return-1!==e[i]?r[e[i]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=r[e[t]],++t,this.second=r[e[t]],++t,this.ratio=e[t],++t),t},Me.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},Me.prototype.isIndexed=function(){return g.defined(this.index)},Me.prototype.getH=function(){return g.defined(this.index)?this.heightBuffer[this.index]:fe.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},Me.prototype.getU=function(){return g.defined(this.index)?this.uBuffer[this.index]:fe.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},Me.prototype.getV=function(){return g.defined(this.index)?this.vBuffer[this.index]:fe.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var o=new de.Cartesian2,d=-1,p=[new de.Cartesian3,new de.Cartesian3],a=[new de.Cartesian3,new de.Cartesian3];function f(e,i){var r=p[++d],t=a[d],r=n.AttributeCompression.octDecode(e.first.getNormalX(),e.first.getNormalY(),r),t=n.AttributeCompression.octDecode(e.second.getNormalX(),e.second.getNormalY(),t);return ye=de.Cartesian3.lerp(r,t,e.ratio,ye),de.Cartesian3.normalize(ye,ye),n.AttributeCompression.octEncode(ye,i),--d,i}Me.prototype.getNormalX=function(){return g.defined(this.index)?this.normalBuffer[2*this.index]:(o=f(this,o)).x},Me.prototype.getNormalY=function(){return g.defined(this.index)?this.normalBuffer[2*this.index+1]:(o=f(this,o)).y};var w=[];function Ne(e,i,r,t,n,s,h,u,o){if(0!==h.length){for(var d=0,p=0;p<h.length;)p=w[d++].initializeFromClipResult(h,p,u);for(var a=0;a<d;++a){var f,l,c=w[a];c.isIndexed()?(c.newIndex=s[c.index],c.uBuffer=e,c.vBuffer=i,c.heightBuffer=r,o&&(c.normalBuffer=t)):(f=c.getKey(),g.defined(s[f])?c.newIndex=s[f]:(l=e.length,e.push(c.getU()),i.push(c.getV()),r.push(c.getH()),o&&(t.push(c.getNormalX()),t.push(c.getNormalY())),c.newIndex=l,s[f]=l))}3===d?(n.push(w[0].newIndex),n.push(w[1].newIndex),n.push(w[2].newIndex)):4===d&&(n.push(w[0].newIndex),n.push(w[1].newIndex),n.push(w[2].newIndex),n.push(w[0].newIndex),n.push(w[2].newIndex),n.push(w[3].newIndex))}}return w.push(new Me),w.push(new Me),w.push(new Me),w.push(new Me),e(function(e,i){var r=e.isEastChild,t=e.isNorthChild,n=r?me:0,s=r?ge:me,h=t?me:0,u=t?ge:me,o=be,d=Be,p=Ie,a=Ee;o.length=0,d.length=0,p.length=0,a.length=0;var f=Ae;f.length=0;for(var l={},c=e.vertices,g=(g=e.indices).subarray(0,e.indexCountWithoutSkirts),m=pe.TerrainEncoding.clone(e.encoding),w=m.hasVertexNormals,x=e.exaggeration,v=0,C=e.vertexCountWithoutSkirts,y=e.minimumHeight,b=e.maximumHeight,B=new Array(C),I=new Array(C),A=new Array(C),E=w?new Array(2*C):void 0,D=0,T=0;D<C;++D,T+=2){var O=m.decodeTextureCoordinates(c,D,ze),z=m.decodeHeight(c,D)/x,k=fe.CesiumMath.clamp(O.x*ge|0,0,ge),M=fe.CesiumMath.clamp(O.y*ge|0,0,ge);A[D]=fe.CesiumMath.clamp((z-y)/(b-y)*ge|0,0,ge),ge-(k=k<20?0:k)<20&&(k=ge),ge-(M=M<20?0:M)<20&&(M=ge),B[D]=k,I[D]=M,w&&(O=m.getOctEncodedNormal(c,D,ke),E[T]=O.x,E[T+1]=O.y),(r&&me<=k||!r&&k<=me)&&(t&&me<=M||!t&&M<=me)&&(l[D]=v,o.push(k),d.push(M),p.push(A[D]),w&&(a.push(E[T]),a.push(E[T+1])),++v)}var N=[];N.push(new Me),N.push(new Me),N.push(new Me);var V=[];for(V.push(new Me),V.push(new Me),V.push(new Me),D=0;D<g.length;D+=3){var q=g[D],R=g[D+1],H=g[D+2],S=B[q],U=B[R],F=B[H];N[0].initializeIndexed(B,I,A,E,q),N[1].initializeIndexed(B,I,A,E,R),N[2].initializeIndexed(B,I,A,E,H);U=ce.clipTriangleAtAxisAlignedThreshold(me,r,S,U,F,we);U.length<=0||(F=V[0].initializeFromClipResult(U,0,N))>=U.length||(F=V[1].initializeFromClipResult(U,F,N))>=U.length||(F=V[2].initializeFromClipResult(U,F,N),Ne(o,d,p,a,f,l,ce.clipTriangleAtAxisAlignedThreshold(me,t,V[0].getV(),V[1].getV(),V[2].getV(),xe),V,w),F<U.length&&(V[2].clone(V[1]),V[2].initializeFromClipResult(U,F,N),Ne(o,d,p,a,f,l,ce.clipTriangleAtAxisAlignedThreshold(me,t,V[0].getV(),V[1].getV(),V[2].getV(),xe),V,w)))}var P=r?-ge:0,W=t?-ge:0,X=[],K=[],L=[],Y=[],_=Number.MAX_VALUE,G=-_,J=ve;J.length=0;var Z=de.Ellipsoid.clone(e.ellipsoid),j=(ue=de.Rectangle.clone(e.childRectangle)).north,Q=ue.south,$=ue.east,ee=ue.west;for($<ee&&($+=fe.CesiumMath.TWO_PI),D=0;D<o.length;++D)k=(k=Math.round(o[D]))<=n?(X.push(D),0):s<=k?(L.push(D),ge):2*k+P,o[D]=k,M=(M=Math.round(d[D]))<=h?(K.push(D),0):u<=M?(Y.push(D),ge):2*M+W,d[D]=M,(z=fe.CesiumMath.lerp(y,b,p[D]/ge))<_&&(_=z),G<z&&(G=z),p[D]=z,Ce.longitude=fe.CesiumMath.lerp(ee,$,k/ge),Ce.latitude=fe.CesiumMath.lerp(Q,j,M/ge),Ce.height=z,Z.cartographicToCartesian(Ce,ye),J.push(ye.x),J.push(ye.y),J.push(ye.z);var ie=oe.BoundingSphere.fromVertices(J,de.Cartesian3.ZERO,3,Te),re=le.OrientedBoundingBox.fromRectangle(ue,_,G,Z,Oe),e=new pe.EllipsoidalOccluder(Z).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(ie.center,J,3,ie.center,_,De),te=G-_,ne=new Uint16Array(o.length+d.length+p.length);for(D=0;D<o.length;++D)ne[D]=o[D];var se=o.length;for(D=0;D<d.length;++D)ne[se+D]=d[D];for(se+=d.length,D=0;D<p.length;++D)ne[se+D]=ge*(p[D]-_)/te;var he,ue=ae.IndexDatatype.createTypedArray(o.length,f);return w?(he=new Uint8Array(a),i.push(ne.buffer,ue.buffer,he.buffer),he=he.buffer):i.push(ne.buffer,ue.buffer),{vertices:ne.buffer,encodedNormals:he,indices:ue.buffer,minimumHeight:_,maximumHeight:G,westIndices:X,southIndices:K,eastIndices:L,northIndices:Y,boundingSphere:ie,orientedBoundingBox:re,horizonOcclusionPoint:e}})});
//# sourceMappingURL=upsampleQuantizedTerrainMesh.js.map
