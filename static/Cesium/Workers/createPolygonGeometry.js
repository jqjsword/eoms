define(["./when-208fe5b0","./Cartesian2-716c2715","./ArcType-dc1c5aee","./GeometryOffsetAttribute-d63c288d","./BoundingRectangle-307ba31b","./Transforms-f1816abc","./Check-d18af7c4","./ComponentDatatype-549ec0d3","./EllipsoidGeodesic-4bc5cec5","./EllipsoidTangentPlane-8e486e83","./GeometryAttribute-0ee94cf1","./GeometryInstance-73b5b8d6","./GeometryPipeline-df743242","./IndexDatatype-d9b71b2b","./Math-3ba16bed","./PolygonGeometryLibrary-7f112f2e","./PolygonPipeline-ac89187a","./VertexFormat-24041ad5","./RuntimeError-7f634f5d","./WebGLConstants-76bb35d1","./IntersectionTests-680c4e46","./Plane-f5dfabcd","./AttributeCompression-69c5b20c","./EncodedCartesian3-7a9c1496","./arrayRemoveDuplicates-28d5a12e","./EllipsoidRhumbLine-886cd793","./GeometryAttributes-b0b294d8"],function(z,U,c,W,e,Y,f,j,y,x,Q,E,G,O,q,H,D,b,t,o,r,a,i,n,s,l,u){"use strict";var K=new U.Cartographic,Z=new U.Cartographic;var V=new e.BoundingRectangle,J=new U.Cartesian3,X=new U.Cartesian3,$=new U.Cartesian3,ee=new U.Cartesian3,te=new U.Cartesian3,oe=new U.Cartesian3,re=new U.Cartesian3,ae=new U.Cartesian3,ie=new U.Cartesian3,ne=new U.Cartesian2,se=new U.Cartesian2,le=new U.Cartesian3,ue=new Y.Quaternion,pe=new Y.Matrix3,ce=new Y.Matrix3;function F(e){var t,o=e.vertexFormat,r=e.geometry,a=e.shadowVolume,i=r.attributes.position.values,n=i.length,s=e.wall,l=e.top||s,u=e.bottom||s;if(o.st||o.normal||o.tangent||o.bitangent||a){var p=e.boundingRectangle,c=e.tangentPlane,y=e.ellipsoid,d=e.stRotation,g=e.perPositionHeight,m=ne;m.x=p.x,m.y=p.y;var h,f=o.st?new Float32Array(n/3*2):void 0;o.normal&&(h=g&&l&&!s?r.attributes.normal.values:new Float32Array(n));var b,v=o.tangent?new Float32Array(n):void 0,_=o.bitangent?new Float32Array(n):void 0,P=a?new Float32Array(n):void 0,C=0,T=0,w=X,I=$,A=ee,x=!0,E=pe,G=ce;G=0!==d?(b=Y.Quaternion.fromAxisAngle(c._plane.normal,d,ue),E=Y.Matrix3.fromQuaternion(b,E),b=Y.Quaternion.fromAxisAngle(c._plane.normal,-d,ue),Y.Matrix3.fromQuaternion(b,G)):(E=Y.Matrix3.clone(Y.Matrix3.IDENTITY,E),Y.Matrix3.clone(Y.Matrix3.IDENTITY,G));var O=0,H=0;l&&u&&(O=n/2,H=n/3,n/=2);for(var D=0;D<n;D+=3){var V,F,L,N,R,M,S,k,B=U.Cartesian3.fromArray(i,D,le);o.st&&(V=Y.Matrix3.multiplyByVector(E,B,J),V=y.scaleToGeodeticSurface(V,V),F=c.projectPointOntoPlane(V,se),U.Cartesian2.subtract(F,m,F),L=q.CesiumMath.clamp(F.x/p.width,0,1),N=q.CesiumMath.clamp(F.y/p.height,0,1),u&&(f[C+H]=L,f[C+1+H]=N),l&&(f[C]=L,f[C+1]=N),C+=2),(o.normal||o.tangent||o.bitangent||a)&&(R=T+1,M=T+2,s?(D+3<n&&(S=U.Cartesian3.fromArray(i,D+3,te),x&&(k=U.Cartesian3.fromArray(i,D+n,oe),g&&(t=B,V=S,F=k,L=void 0,L=(N=y).cartesianToCartographic(t,K).height,(t=N.cartesianToCartographic(V,Z)).height=L,N.cartographicToCartesian(t,V),(V=N.cartesianToCartographic(F,Z)).height=L-100,N.cartographicToCartesian(V,F)),U.Cartesian3.subtract(S,B,S),U.Cartesian3.subtract(k,B,k),w=U.Cartesian3.normalize(U.Cartesian3.cross(k,S,w),w),x=!1),U.Cartesian3.equalsEpsilon(S,B,q.CesiumMath.EPSILON10)&&(x=!0)),(o.tangent||o.bitangent)&&(A=y.geodeticSurfaceNormal(B,A),o.tangent&&(I=U.Cartesian3.normalize(U.Cartesian3.cross(A,w,I),I)))):(w=y.geodeticSurfaceNormal(B,w),(o.tangent||o.bitangent)&&(g&&(re=U.Cartesian3.fromArray(h,T,re),ae=U.Cartesian3.cross(U.Cartesian3.UNIT_Z,re,ae),ae=U.Cartesian3.normalize(Y.Matrix3.multiplyByVector(G,ae,ae),ae),o.bitangent&&(ie=U.Cartesian3.normalize(U.Cartesian3.cross(re,ae,ie),ie))),I=U.Cartesian3.cross(U.Cartesian3.UNIT_Z,w,I),I=U.Cartesian3.normalize(Y.Matrix3.multiplyByVector(G,I,I),I),o.bitangent&&(A=U.Cartesian3.normalize(U.Cartesian3.cross(w,I,A),A)))),o.normal&&(e.wall?(h[T+O]=w.x,h[R+O]=w.y,h[M+O]=w.z):u&&(h[T+O]=-w.x,h[R+O]=-w.y,h[M+O]=-w.z),(l&&!g||s)&&(h[T]=w.x,h[R]=w.y,h[M]=w.z)),a&&(s&&(w=y.geodeticSurfaceNormal(B,w)),P[T+O]=-w.x,P[R+O]=-w.y,P[M+O]=-w.z),o.tangent&&(e.wall?(v[T+O]=I.x,v[R+O]=I.y,v[M+O]=I.z):u&&(v[T+O]=-I.x,v[R+O]=-I.y,v[M+O]=-I.z),l&&(g?(v[T]=ae.x,v[R]=ae.y,v[M]=ae.z):(v[T]=I.x,v[R]=I.y,v[M]=I.z))),o.bitangent&&(u&&(_[T+O]=A.x,_[R+O]=A.y,_[M+O]=A.z),l&&(g?(_[T]=ie.x,_[R]=ie.y,_[M]=ie.z):(_[T]=A.x,_[R]=A.y,_[M]=A.z))),T+=3)}o.st&&(r.attributes.st=new Q.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:f})),o.normal&&(r.attributes.normal=new Q.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:h})),o.tangent&&(r.attributes.tangent=new Q.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:v})),o.bitangent&&(r.attributes.bitangent=new Q.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:_})),a&&(r.attributes.extrudeDirection=new Q.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:P}))}return e.extrude&&z.defined(e.offsetAttribute)&&(d=i.length/3,b=new Uint8Array(d),e.offsetAttribute===W.GeometryOffsetAttribute.TOP?l&&u||s?b=W.arrayFill(b,1,0,d/2):l&&(b=W.arrayFill(b,1)):(d=e.offsetAttribute===W.GeometryOffsetAttribute.NONE?0:1,b=W.arrayFill(b,d)),r.attributes.applyOffset=new Q.GeometryAttribute({componentDatatype:j.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})),r}var d=new U.Cartographic,g=new U.Cartographic,m={westOverIDL:0,eastOverIDL:0},h=new y.EllipsoidGeodesic;function p(e,t,o,r,a){if(a=z.defaultValue(a,new U.Rectangle),!z.defined(e)||e.length<3)return a.west=0,a.north=0,a.south=0,a.east=0,a;if(o===c.ArcType.RHUMB)return U.Rectangle.fromCartesianArray(e,t,a);h.ellipsoid.equals(t)||(h=new y.EllipsoidGeodesic(void 0,void 0,t)),a.west=Number.POSITIVE_INFINITY,a.east=Number.NEGATIVE_INFINITY,a.south=Number.POSITIVE_INFINITY,a.north=Number.NEGATIVE_INFINITY,m.westOverIDL=Number.POSITIVE_INFINITY,m.eastOverIDL=Number.NEGATIVE_INFINITY;for(var i,n=1/q.CesiumMath.chordLength(r,t.maximumRadius),s=e.length,l=t.cartesianToCartographic(e[0],g),u=d,p=1;p<s;p++)i=u,u=l,l=t.cartesianToCartographic(e[p],i),h.setEndPoints(u,l),_(h,n,a,m);return i=u,u=l,l=t.cartesianToCartographic(e[0],i),h.setEndPoints(u,l),_(h,n,a,m),a.east-a.west>m.eastOverIDL-m.westOverIDL&&(a.west=m.westOverIDL,a.east=m.eastOverIDL,a.east>q.CesiumMath.PI&&(a.east=a.east-q.CesiumMath.TWO_PI),a.west>q.CesiumMath.PI&&(a.west=a.west-q.CesiumMath.TWO_PI)),a}var v=new U.Cartographic;function _(e,t,o,r){for(var a=e.surfaceDistance,i=Math.ceil(a*t),n=0<i?a/(i-1):Number.POSITIVE_INFINITY,s=0,l=0;l<i;l++){var u=e.interpolateUsingSurfaceDistance(s,v);s+=n;var p=u.longitude,u=u.latitude;o.west=Math.min(o.west,p),o.east=Math.max(o.east,p),o.south=Math.min(o.south,u),o.north=Math.max(o.north,u);p=0<=p?p:p+q.CesiumMath.TWO_PI;r.westOverIDL=Math.min(r.westOverIDL,p),r.eastOverIDL=Math.max(r.eastOverIDL,p)}}var L=[];function P(e){if(f.Check.typeOf.object("options",e),f.Check.typeOf.object("options.polygonHierarchy",e.polygonHierarchy),z.defined(e.perPositionHeight)&&e.perPositionHeight&&z.defined(e.height))throw new f.DeveloperError("Cannot use both options.perPositionHeight and options.height");if(z.defined(e.arcType)&&e.arcType!==c.ArcType.GEODESIC&&e.arcType!==c.ArcType.RHUMB)throw new f.DeveloperError("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");var t,o=e.polygonHierarchy,r=z.defaultValue(e.vertexFormat,b.VertexFormat.DEFAULT),a=z.defaultValue(e.ellipsoid,U.Ellipsoid.WGS84),i=z.defaultValue(e.granularity,q.CesiumMath.RADIANS_PER_DEGREE),n=z.defaultValue(e.stRotation,0),s=z.defaultValue(e.perPositionHeight,!1),l=s&&z.defined(e.extrudedHeight),u=z.defaultValue(e.height,0),p=z.defaultValue(e.extrudedHeight,u);l||(t=Math.max(u,p),p=Math.min(u,p),u=t),this._vertexFormat=b.VertexFormat.clone(r),this._ellipsoid=U.Ellipsoid.clone(a),this._granularity=i,this._stRotation=n,this._height=u,this._extrudedHeight=p,this._closeTop=z.defaultValue(e.closeTop,!0),this._closeBottom=z.defaultValue(e.closeBottom,!0),this._polygonHierarchy=o,this._perPositionHeight=s,this._perPositionHeightExtrude=l,this._shadowVolume=z.defaultValue(e.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=e.offsetAttribute,this._arcType=z.defaultValue(e.arcType,c.ArcType.GEODESIC),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=H.PolygonGeometryLibrary.computeHierarchyPackedLength(o)+U.Ellipsoid.packedLength+b.VertexFormat.packedLength+12}P.fromPositions=function(e){return e=z.defaultValue(e,z.defaultValue.EMPTY_OBJECT),f.Check.defined("options.positions",e.positions),new P({polygonHierarchy:{positions:e.positions},height:e.height,extrudedHeight:e.extrudedHeight,vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,closeTop:e.closeTop,closeBottom:e.closeBottom,offsetAttribute:e.offsetAttribute,arcType:e.arcType})},P.pack=function(e,t,o){return f.Check.typeOf.object("value",e),f.Check.defined("array",t),o=z.defaultValue(o,0),o=H.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,o),U.Ellipsoid.pack(e._ellipsoid,t,o),o+=U.Ellipsoid.packedLength,b.VertexFormat.pack(e._vertexFormat,t,o),o+=b.VertexFormat.packedLength,t[o++]=e._height,t[o++]=e._extrudedHeight,t[o++]=e._granularity,t[o++]=e._stRotation,t[o++]=e._perPositionHeightExtrude?1:0,t[o++]=e._perPositionHeight?1:0,t[o++]=e._closeTop?1:0,t[o++]=e._closeBottom?1:0,t[o++]=e._shadowVolume?1:0,t[o++]=z.defaultValue(e._offsetAttribute,-1),t[o++]=e._arcType,t[o]=e.packedLength,t};var C=U.Ellipsoid.clone(U.Ellipsoid.UNIT_SPHERE),T=new b.VertexFormat,w={polygonHierarchy:{}};return P.unpack=function(e,t,o){f.Check.defined("array",e),t=z.defaultValue(t,0);var r=H.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=r.startingIndex,delete r.startingIndex;var a=U.Ellipsoid.unpack(e,t,C);t+=U.Ellipsoid.packedLength;var i=b.VertexFormat.unpack(e,t,T);t+=b.VertexFormat.packedLength;var n=e[t++],s=e[t++],l=e[t++],u=e[t++],p=1===e[t++],c=1===e[t++],y=1===e[t++],d=1===e[t++],g=1===e[t++],m=e[t++],h=e[t++],t=e[t];return(o=!z.defined(o)?new P(w):o)._polygonHierarchy=r,o._ellipsoid=U.Ellipsoid.clone(a,o._ellipsoid),o._vertexFormat=b.VertexFormat.clone(i,o._vertexFormat),o._height=n,o._extrudedHeight=s,o._granularity=l,o._stRotation=u,o._perPositionHeightExtrude=p,o._perPositionHeight=c,o._closeTop=y,o._closeBottom=d,o._shadowVolume=g,o._offsetAttribute=-1===m?void 0:m,o._arcType=h,o.packedLength=t,o},P.computeRectangle=function(e,t){f.Check.typeOf.object("options",e),f.Check.typeOf.object("options.polygonHierarchy",e.polygonHierarchy);var o=z.defaultValue(e.granularity,q.CesiumMath.RADIANS_PER_DEGREE),r=z.defaultValue(e.arcType,c.ArcType.GEODESIC);if(r!==c.ArcType.GEODESIC&&r!==c.ArcType.RHUMB)throw new f.DeveloperError("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");var a=e.polygonHierarchy,e=z.defaultValue(e.ellipsoid,U.Ellipsoid.WGS84);return p(a.positions,e,r,o,t)},P.createGeometry=function(e){var t=e._vertexFormat,o=e._ellipsoid,r=e._granularity,a=e._stRotation,i=e._polygonHierarchy,n=e._perPositionHeight,s=e._closeTop,l=e._closeBottom,u=e._arcType;if(!((g=i.positions).length<3)){var p=x.EllipsoidTangentPlane.fromPoints(g,o),i=H.PolygonGeometryLibrary.polygonsFromHierarchy(i,p.projectPointsOntoPlane.bind(p),!n,o),c=i.hierarchy,y=i.polygons;if(0!==c.length){var d,g=c[0].outerRing,g=H.PolygonGeometryLibrary.computeBoundingRectangle(p.plane.normal,p.projectPointOntoPlane.bind(p),g,a,V),m=[],h=e._height,f=e._extrudedHeight,b={perPositionHeight:n,vertexFormat:t,geometry:void 0,tangentPlane:p,boundingRectangle:g,ellipsoid:o,stRotation:a,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:u};if(e._perPositionHeightExtrude||!q.CesiumMath.equalsEpsilon(h,f,0,q.CesiumMath.EPSILON2))for(b.extrude=!0,b.top=s,b.bottom=l,b.shadowVolume=e._shadowVolume,b.offsetAttribute=e._offsetAttribute,d=0;d<y.length;d++){var v,_=function(e,t,o,r,a,i,n,s,l){var u={walls:[]};if(i||n){var p=H.PolygonGeometryLibrary.createGeometryFromPositions(e,t,o,a,s,l),t=p.attributes.position.values,c=p.indices;if(i&&n){var y,i=t.concat(t),d=i.length/3;(y=O.IndexDatatype.createTypedArray(d,2*c.length)).set(c);for(var g=c.length,m=d/2,h=0;h<g;h+=3){var f=y[h]+m,b=y[h+1]+m,v=y[h+2]+m;y[h+g]=v,y[h+1+g]=b,y[h+2+g]=f}p.attributes.position.values=i,a&&s.normal&&(s=p.attributes.normal.values,p.attributes.normal.values=new Float32Array(i.length),p.attributes.normal.values.set(s)),p.indices=y}else if(n){for(d=t.length/3,y=O.IndexDatatype.createTypedArray(d,c.length),h=0;h<c.length;h+=3)y[h]=c[h+2],y[h+1]=c[h+1],y[h+2]=c[h];p.indices=y}u.topAndBottom=new E.GeometryInstance({geometry:p})}var p=r.outerRing,_=x.EllipsoidTangentPlane.fromPoints(p,e).projectPointsOntoPlane(p,L);D.PolygonPipeline.computeWindingOrder2D(_)===D.WindingOrder.CLOCKWISE&&(p=p.slice().reverse());var P=H.PolygonGeometryLibrary.computeWallGeometry(p,e,o,a,l);u.walls.push(new E.GeometryInstance({geometry:P}));var C=r.holes;for(h=0;h<C.length;h++){var T=C[h],_=x.EllipsoidTangentPlane.fromPoints(T,e).projectPointsOntoPlane(T,L);D.PolygonPipeline.computeWindingOrder2D(_)===D.WindingOrder.COUNTER_CLOCKWISE&&(T=T.slice().reverse()),P=H.PolygonGeometryLibrary.computeWallGeometry(T,e,o,a,l),u.walls.push(new E.GeometryInstance({geometry:P}))}return u}(o,y[d],r,c[d],n,s,l,t,u);s&&l?(v=_.topAndBottom,b.geometry=H.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(v.geometry,h,f,o,n)):s?((v=_.topAndBottom).geometry.attributes.position.values=D.PolygonPipeline.scaleToGeodeticHeight(v.geometry.attributes.position.values,h,o,!n),b.geometry=v.geometry):l&&((v=_.topAndBottom).geometry.attributes.position.values=D.PolygonPipeline.scaleToGeodeticHeight(v.geometry.attributes.position.values,f,o,!0),b.geometry=v.geometry),(s||l)&&(b.wall=!1,v.geometry=F(b),m.push(v));var P=_.walls;b.wall=!0;for(var C=0;C<P.length;C++){var T=P[C];b.geometry=H.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(T.geometry,h,f,o,n),T.geometry=F(b),m.push(T)}}else for(d=0;d<y.length;d++){var w,I,A=new E.GeometryInstance({geometry:H.PolygonGeometryLibrary.createGeometryFromPositions(o,y[d],r,n,t,u)});A.geometry.attributes.position.values=D.PolygonPipeline.scaleToGeodeticHeight(A.geometry.attributes.position.values,h,o,!n),b.geometry=A.geometry,A.geometry=F(b),z.defined(e._offsetAttribute)&&(I=A.geometry.attributes.position.values.length,w=new Uint8Array(I/3),I=e._offsetAttribute===W.GeometryOffsetAttribute.NONE?0:1,W.arrayFill(w,I),A.geometry.attributes.applyOffset=new Q.GeometryAttribute({componentDatatype:j.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:w})),m.push(A)}p=G.GeometryPipeline.combineInstances(m)[0];p.attributes.position.values=new Float64Array(p.attributes.position.values),p.indices=O.IndexDatatype.createTypedArray(p.attributes.position.values.length/3,p.indices);g=p.attributes,a=Y.BoundingSphere.fromVertices(g.position.values);return t.position||delete g.position,new Q.Geometry({attributes:g,indices:p.indices,primitiveType:p.primitiveType,boundingSphere:a,offsetAttribute:e._offsetAttribute})}}},P.createShadowVolume=function(e,t,o){var r=e._granularity,a=e._ellipsoid,t=t(r,a),o=o(r,a);return new P({polygonHierarchy:e._polygonHierarchy,ellipsoid:a,stRotation:e._stRotation,granularity:r,perPositionHeight:!1,extrudedHeight:t,height:o,vertexFormat:b.VertexFormat.POSITION_ONLY,shadowVolume:!0,arcType:e._arcType})},Object.defineProperties(P.prototype,{rectangle:{get:function(){var e;return z.defined(this._rectangle)||(e=this._polygonHierarchy.positions,this._rectangle=p(e,this._ellipsoid,this._arcType,this._granularity)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return z.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0==t)return[0,0,0,1,1,0];var o=e._ellipsoid,r=e._polygonHierarchy.positions,e=e.rectangle;return Q.Geometry._textureCoordinateRotationPoints(r,t,o,e)}(this)),this._textureCoordinateRotationPoints}}}),function(e,t){return(e=z.defined(t)?P.unpack(e,t):e)._ellipsoid=U.Ellipsoid.clone(e._ellipsoid),P.createGeometry(e)}});
//# sourceMappingURL=createPolygonGeometry.js.map
