define(["./arrayRemoveDuplicates-28d5a12e","./BoundingRectangle-307ba31b","./Transforms-f1816abc","./Cartesian2-716c2715","./Check-d18af7c4","./ComponentDatatype-549ec0d3","./CoplanarPolygonGeometryLibrary-dea2b0bb","./when-208fe5b0","./GeometryAttribute-0ee94cf1","./GeometryAttributes-b0b294d8","./GeometryInstance-73b5b8d6","./GeometryPipeline-df743242","./IndexDatatype-d9b71b2b","./Math-3ba16bed","./PolygonGeometryLibrary-7f112f2e","./PolygonPipeline-ac89187a","./VertexFormat-24041ad5","./RuntimeError-7f634f5d","./WebGLConstants-76bb35d1","./OrientedBoundingBox-45cb4e24","./EllipsoidTangentPlane-8e486e83","./IntersectionTests-680c4e46","./Plane-f5dfabcd","./AttributeCompression-69c5b20c","./EncodedCartesian3-7a9c1496","./ArcType-dc1c5aee","./EllipsoidRhumbLine-886cd793"],function(h,e,L,E,s,k,C,l,T,D,f,v,_,V,x,R,p,t,n,a,o,r,i,c,y,u,m){"use strict";var I=new E.Cartesian3,P=new e.BoundingRectangle,M=new E.Cartesian2,H=new E.Cartesian2,w=new E.Cartesian3,A=new E.Cartesian3,F=new E.Cartesian3,G=new E.Cartesian3,B=new E.Cartesian3,O=new E.Cartesian3,z=new L.Quaternion,S=new L.Matrix3,N=new L.Matrix3,Q=new E.Cartesian3;function d(e){var t=(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).polygonHierarchy;s.Check.defined("options.polygonHierarchy",t);var n=l.defaultValue(e.vertexFormat,p.VertexFormat.DEFAULT);this._vertexFormat=p.VertexFormat.clone(n),this._polygonHierarchy=t,this._stRotation=l.defaultValue(e.stRotation,0),this._ellipsoid=E.Ellipsoid.clone(l.defaultValue(e.ellipsoid,E.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=x.PolygonGeometryLibrary.computeHierarchyPackedLength(t)+p.VertexFormat.packedLength+E.Ellipsoid.packedLength+2}d.fromPositions=function(e){return e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT),s.Check.defined("options.positions",e.positions),new d({polygonHierarchy:{positions:e.positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},d.pack=function(e,t,n){return s.Check.typeOf.object("value",e),s.Check.defined("array",t),n=l.defaultValue(n,0),n=x.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,n),E.Ellipsoid.pack(e._ellipsoid,t,n),n+=E.Ellipsoid.packedLength,p.VertexFormat.pack(e._vertexFormat,t,n),n+=p.VertexFormat.packedLength,t[n++]=e._stRotation,t[n]=e.packedLength,t};var g=E.Ellipsoid.clone(E.Ellipsoid.UNIT_SPHERE),b=new p.VertexFormat,j={polygonHierarchy:{}};return d.unpack=function(e,t,n){s.Check.defined("array",e),t=l.defaultValue(t,0);var a=x.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=a.startingIndex,delete a.startingIndex;var o=E.Ellipsoid.unpack(e,t,g);t+=E.Ellipsoid.packedLength;var r=p.VertexFormat.unpack(e,t,b);t+=p.VertexFormat.packedLength;var i=e[t++],t=e[t];return(n=!l.defined(n)?new d(j):n)._polygonHierarchy=a,n._ellipsoid=E.Ellipsoid.clone(o,n._ellipsoid),n._vertexFormat=p.VertexFormat.clone(r,n._vertexFormat),n._stRotation=i,n.packedLength=t,n},d.createGeometry=function(e){var t=e._vertexFormat,n=e._polygonHierarchy,a=e._stRotation,o=n.positions;if(!((o=h.arrayRemoveDuplicates(o,E.Cartesian3.equalsEpsilon,!0)).length<3)){var r=w,i=A,s=F,l=B,p=O;if(C.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(o,G,l,p)){r=E.Cartesian3.cross(l,p,r);r=E.Cartesian3.normalize(r,r),E.Cartesian3.equalsEpsilon(G,E.Cartesian3.ZERO,V.CesiumMath.EPSILON6)||(c=e._ellipsoid.geodeticSurfaceNormal(G,Q),E.Cartesian3.dot(r,c)<0&&(r=E.Cartesian3.negate(r,r),l=E.Cartesian3.negate(l,l)));var c=C.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(G,l,p),y=C.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(G,l,p);t.tangent&&(i=E.Cartesian3.clone(l,i)),t.bitangent&&(s=E.Cartesian3.clone(p,s));var n=x.PolygonGeometryLibrary.polygonsFromHierarchy(n,c,!1),c=n.hierarchy,u=n.polygons;if(0!==c.length){for(var o=c[0].outerRing,n=L.BoundingSphere.fromPoints(o),m=x.PolygonGeometryLibrary.computeBoundingRectangle(r,y,o,a,P),d=[],g=0;g<u.length;g++){var b=new f.GeometryInstance({geometry:function(e,t,n,a,o,r,i,s){var l=e.positions,p=R.PolygonPipeline.triangulate(e.positions2D,e.holes);p.length<3&&(p=[0,1,2]),(e=_.IndexDatatype.createTypedArray(l.length,p.length)).set(p);var c=S;0!==a?(p=L.Quaternion.fromAxisAngle(r,a,z),c=L.Matrix3.fromQuaternion(p,c),(t.tangent||t.bitangent)&&(p=L.Quaternion.fromAxisAngle(r,-a,z),m=L.Matrix3.fromQuaternion(p,N),i=E.Cartesian3.normalize(L.Matrix3.multiplyByVector(m,i,i),i),t.bitangent&&(s=E.Cartesian3.normalize(E.Cartesian3.cross(r,i,s),s)))):c=L.Matrix3.clone(L.Matrix3.IDENTITY,c);var y=H;t.st&&(y.x=n.x,y.y=n.y);for(var u=l.length,m=3*u,d=new Float64Array(m),g=t.normal?new Float32Array(m):void 0,b=t.tangent?new Float32Array(m):void 0,h=t.bitangent?new Float32Array(m):void 0,C=t.st?new Float32Array(2*u):void 0,f=0,v=0,x=0,P=0,w=0,A=0;A<u;A++){var F,G=l[A];d[f++]=G.x,d[f++]=G.y,d[f++]=G.z,t.st&&(F=o(L.Matrix3.multiplyByVector(c,G,I),M),E.Cartesian2.subtract(F,y,F),G=V.CesiumMath.clamp(F.x/n.width,0,1),F=V.CesiumMath.clamp(F.y/n.height,0,1),C[w++]=G,C[w++]=F),t.normal&&(g[v++]=r.x,g[v++]=r.y,g[v++]=r.z),t.tangent&&(b[P++]=i.x,b[P++]=i.y,b[P++]=i.z),t.bitangent&&(h[x++]=s.x,h[x++]=s.y,h[x++]=s.z)}return m=new D.GeometryAttributes,t.position&&(m.position=new T.GeometryAttribute({componentDatatype:k.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:d})),t.normal&&(m.normal=new T.GeometryAttribute({componentDatatype:k.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:g})),t.tangent&&(m.tangent=new T.GeometryAttribute({componentDatatype:k.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:b})),t.bitangent&&(m.bitangent=new T.GeometryAttribute({componentDatatype:k.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:h})),t.st&&(m.st=new T.GeometryAttribute({componentDatatype:k.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:C})),new T.Geometry({attributes:m,indices:e,primitiveType:T.PrimitiveType.TRIANGLES})}(u[g],t,m,a,y,r,i,s)});d.push(b)}c=v.GeometryPipeline.combineInstances(d)[0];c.attributes.position.values=new Float64Array(c.attributes.position.values),c.indices=_.IndexDatatype.createTypedArray(c.attributes.position.values.length/3,c.indices);o=c.attributes;return t.position||delete o.position,new T.Geometry({attributes:o,indices:c.indices,primitiveType:c.primitiveType,boundingSphere:n})}}}},function(e,t){return l.defined(t)&&(e=d.unpack(e,t)),d.createGeometry(e)}});
//# sourceMappingURL=createCoplanarPolygonGeometry.js.map
